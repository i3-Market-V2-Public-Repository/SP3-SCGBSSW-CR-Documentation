<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="562px" preserveAspectRatio="none" style="width:599px;height:562px;background:#FFFFFF;" version="1.1" viewBox="0 0 599 562" width="599px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="DejaVu Sans" font-size="18" lengthAdjust="spacing" textLength="544" x="31.75" y="28.708">i3M NRP - step 2: consumer sends a Proof of Reception (PoR)</text><rect fill="#FFFFFF" height="515.3125" style="stroke:#A80036;stroke-width:1.0;" width="165" x="16" y="40.9531"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="105" x="46" y="53.02">i3M Consumer</text><rect fill="#FFFFFF" height="515.3125" style="stroke:#A80036;stroke-width:1.0;" width="188" x="362.5" y="40.9531"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="93" x="410" y="53.02">i3M Provider</text><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="93.5" y="240.6094"/><rect fill="#FFFFFF" height="191.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451.5" y="304.7422"/><rect fill="#FFFFFF" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="546.5" x="10" y="361.875"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="98" x2="98" y1="107.6797" y2="505.6719"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="456.5" x2="456.5" y1="107.6797" y2="505.6719"/><rect fill="#99FF99" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="157" x="20" y="76.3828"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="143" x="27" y="96.3779">Consumer: SDA SDK</text><rect fill="#99FF99" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="157" x="20" y="504.6719"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="143" x="27" y="524.667">Consumer: SDA SDK</text><rect fill="#FFAAAA" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="180" x="366.5" y="60.0859"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="54" x="429.5" y="80.0811">SDA API</text><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="166" x="373.5" y="96.3779">: Data Transfer Manager</text><rect fill="#FFAAAA" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="180" x="366.5" y="504.6719"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="54" x="429.5" y="524.667">SDA API</text><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="166" x="373.5" y="540.9639">: Data Transfer Manager</text><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="93.5" y="240.6094"/><rect fill="#FFFFFF" height="191.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="451.5" y="304.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="103.5" x2="145.5" y1="232.6094" y2="232.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="145.5" x2="145.5" y1="232.6094" y2="245.6094"/><line style="stroke:#A80036;stroke-width:1.0;" x1="104.5" x2="145.5" y1="245.6094" y2="245.6094"/><polygon fill="#A80036" points="114.5,241.6094,104.5,245.6094,114.5,249.6094,110.5,245.6094" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="56" x="110.5" y="133.7466">PoR=JWS</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="10" lengthAdjust="spacing" textLength="48" x="166.5" y="137.4541">consumer</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="16" x="214.5" y="133.7466">({</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="96" x="126.5" y="151.8794">iss: 'dest',</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="136" x="126.5" y="167.0122">proofType: 'PoR',</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="168" x="126.5" y="182.145">iat: &lt;timestamp_now&gt;,</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="328" x="126.5" y="197.2778">poo: string, // The PoO as a compact JWS.</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="320" x="126.5" y="212.4106">exchange: &lt;the same exchange in the PoO&gt;</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="16" x="110.5" y="227.5435">})</text><path d="M461,165.5117 L461,205.5117 L592,205.5117 L592,175.5117 L582,165.5117 L461,165.5117 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M582,165.5117 L582,175.5117 L592,175.5117 L582,165.5117 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="110" x="467" y="182.5786">1. create proof of</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="98" x="467" y="197.7114">reception (PoR)</text><polygon fill="#A80036" points="439.5,300.7422,449.5,304.7422,439.5,308.7422,443.5,304.7422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="98.5" x2="445.5" y1="304.7422" y2="304.7422"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="24" x="105.5" y="299.6763">PoR</text><line style="stroke:#A80036;stroke-width:1.0;" x1="461.5" x2="503.5" y1="333.875" y2="333.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503.5" x2="503.5" y1="333.875" y2="346.875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="462.5" x2="503.5" y1="346.875" y2="346.875"/><polygon fill="#A80036" points="472.5,342.875,462.5,346.875,472.5,350.875,468.5,346.875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="96" x="468.5" y="328.8091">validate PoR</text><path d="M331,321.2422 L331,346.2422 L446,346.2422 L446,331.2422 L436,321.2422 L331,321.2422 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M436,321.2422 L436,331.2422 L446,331.2422 L436,321.2422 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="94" x="337" y="338.3091">2. validate PoR</text><path d="M10,361.875 L80,361.875 L80,368.875 L70,378.875 L10,378.875 L10,361.875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="546.5" x="10" y="361.875"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="25" y="374.9419">opt</text><text fill="#000000" font-family="DejaVu Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="81" x="95" y="374.0854">[invalid PoR]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="98.5" x2="108.5" y1="400.1406" y2="396.1406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="98.5" x2="108.5" y1="400.1406" y2="404.1406"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="98.5" x2="450.5" y1="400.1406" y2="400.1406"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="72" x="115.5" y="395.0747">terminate</text><line style="stroke:#A80036;stroke-width:2.0;" x1="89.5" x2="107.5" y1="391.1406" y2="409.1406"/><line style="stroke:#A80036;stroke-width:2.0;" x1="89.5" x2="107.5" y1="409.1406" y2="391.1406"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461.5" x2="503.5" y1="455.4727" y2="455.4727"/><line style="stroke:#A80036;stroke-width:1.0;" x1="503.5" x2="503.5" y1="455.4727" y2="468.4727"/><line style="stroke:#A80036;stroke-width:1.0;" x1="462.5" x2="503.5" y1="468.4727" y2="468.4727"/><polygon fill="#A80036" points="472.5,464.4727,462.5,468.4727,472.5,472.4727,468.5,468.4727" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="80" x="468.5" y="450.4067">store PoR.</text><path d="M186,420.1406 L186,490.1406 L446,490.1406 L446,430.1406 L436,420.1406 L186,420.1406 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M436,420.1406 L436,430.1406 L446,430.1406 L436,420.1406 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="81" x="192" y="437.2075">3. store PoR.</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="218" x="192" y="452.3403">The PoR is non-repudiable proof of</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="239" x="192" y="467.4731">the consumer being commited to get</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="235" x="192" y="482.606">the secret to decrypt the cipherblock</text><!--MD5=[e4bc4f0b4fb46ecb1baf9b4bf8191653]
@startuml nrpStep2
skinparam shadowing false
skinparam DefaultFontName DejaVu Sans
skinparam DefaultMonospacedFontName DejaVu Sans Mono
skinparam ArrowFontName DejaVu Sans Mono
skinparam maxMessageSize 450

title "i3M NRP - step 2: consumer sends a Proof of Reception (PoR)"

box "i3M Consumer" #White
  participant "Consumer: SDA SDK" as C #99FF99
end box
box "i3M Provider" #White
  participant "SDA API\n: Data Transfer Manager" as P #FFAAAA
end box

C->C++: PoR=JWS<sub>consumer</sub>({\n  iss: 'dest',\n  proofType: 'PoR',\n  iat: <timestamp_now>,\n  poo: string, // The PoO as a compact JWS.\n  exchange: <the same exchange in the PoO>\n})
note right #E9FFE9
  1. create proof of
  reception (PoR)
end note
C- -

C->P++: PoR
P->P: validate PoR
note left #FFE9E9
  2. validate PoR
end note
opt invalid PoR
  P- ->>C !!: terminate
end
P->P: store PoR.
note left #FFE9E9
  3. store PoR.
  The PoR is non-repudiable proof of
  the consumer being commited to get
  the secret to decrypt the cipherblock
end note
@enduml

PlantUML version 1.2021.16(Wed Dec 08 18:25:22 CET 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>