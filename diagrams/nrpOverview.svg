<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1694px" preserveAspectRatio="none" style="width:832px;height:1694px;background:#FFFFFF;" version="1.1" viewBox="0 0 832 1694" width="832px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="DejaVu Sans" font-size="18" lengthAdjust="spacing" textLength="325" x="250.25" y="28.708">i3-MARKET non-repudiation protocol</text><rect fill="#FFFFFF" height="1647.625" style="stroke:#A80036;stroke-width:1.0;" width="165" x="16" y="40.9531"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="105" x="46" y="53.02">i3M Consumer</text><rect fill="#FFFFFF" height="1647.625" style="stroke:#A80036;stroke-width:1.0;" width="188" x="310.5" y="40.9531"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="93" x="358" y="53.02">i3M Provider</text><rect fill="#FBFBFF" height="1647.625" style="stroke:#A80036;stroke-width:1.0;" width="128" x="681.5" y="40.9531"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108" x="691.5" y="53.02">i3M Backplane</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="0" x="748" y="68.1528"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="93.5" y="534.7734"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="93.5" y="707.8711"/><rect fill="#FFFFFF" height="290.4961" style="stroke:#A80036;stroke-width:1.0;" width="10" x="399.5" y="184.9453"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="404.5" y="229.1445"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="404.5" y="318.4766"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="404.5" y="400.7422"/><rect fill="#FFFFFF" height="852.9141" style="stroke:#A80036;stroke-width:1.0;" width="10" x="399.5" y="776.0703"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="740.5" y="1466.3203"/><rect fill="#FFFFFF" height="260.7266" style="stroke:#000000;stroke-width:2.0;" width="805.5" x="10" y="1242.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="98" x2="98" y1="107.6797" y2="1637.9844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="404.5" x2="404.5" y1="107.6797" y2="1637.9844"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="745.5" x2="745.5" y1="107.6797" y2="1637.9844"/><rect fill="#99FF99" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="157" x="20" y="76.3828"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="143" x="27" y="96.3779">Consumer: SDA SDK</text><rect fill="#99FF99" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="157" x="20" y="1636.9844"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="143" x="27" y="1656.9795">Consumer: SDA SDK</text><rect fill="#FFAAAA" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="180" x="314.5" y="60.0859"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="54" x="377.5" y="80.0811">SDA API</text><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="166" x="321.5" y="96.3779">: Data Transfer Manager</text><rect fill="#FFAAAA" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="180" x="314.5" y="1636.9844"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="54" x="377.5" y="1656.9795">SDA API</text><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="166" x="321.5" y="1673.2764">: Data Transfer Manager</text><rect fill="#FEFECE" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="120" x="685.5" y="76.3828"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="106" x="692.5" y="96.3779">i3-MARKET DLT</text><rect fill="#FEFECE" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="120" x="685.5" y="1636.9844"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="106" x="692.5" y="1656.9795">i3-MARKET DLT</text><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="93.5" y="534.7734"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="93.5" y="707.8711"/><rect fill="#FFFFFF" height="290.4961" style="stroke:#A80036;stroke-width:1.0;" width="10" x="399.5" y="184.9453"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="404.5" y="229.1445"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="404.5" y="318.4766"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="404.5" y="400.7422"/><rect fill="#FFFFFF" height="852.9141" style="stroke:#A80036;stroke-width:1.0;" width="10" x="399.5" y="776.0703"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="740.5" y="1466.3203"/><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="825.5" x="0" y="138.2461"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="825.5" y1="138.2461" y2="138.2461"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="825.5" y1="141.2461" y2="141.2461"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="588" x="118.75" y="127.6797"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="569" x="124.75" y="143.7466">step 1: consumer gets cipherblock and non-repudiable Proof of Origin (PoO)</text><polygon fill="#A80036" points="387.5,180.9453,397.5,184.9453,387.5,188.9453,391.5,184.9453" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="98.5" x2="393.5" y1="184.9453" y2="184.9453"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="208" x="105.5" y="179.8794">GET data {id?: &lt;block_id&gt;}</text><path d="M414,165.8125 L414,190.8125 L585,190.8125 L585,175.8125 L575,165.8125 L414,165.8125 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M575,165.8125 L575,175.8125 L585,175.8125 L575,165.8125 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="150" x="420" y="182.8794">1. query a block of data</text><line style="stroke:#A80036;stroke-width:1.0;" x1="414.5" x2="456.5" y1="221.1445" y2="221.1445"/><line style="stroke:#A80036;stroke-width:1.0;" x1="456.5" x2="456.5" y1="221.1445" y2="234.1445"/><line style="stroke:#A80036;stroke-width:1.0;" x1="415.5" x2="456.5" y1="234.1445" y2="234.1445"/><polygon fill="#A80036" points="425.5,230.1445,415.5,234.1445,425.5,238.1445,421.5,234.1445" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="176" x="421.5" y="216.0786">create one-time secret</text><path d="M168,200.9453 L168,240.9453 L394,240.9453 L394,210.9453 L384,200.9453 L168,200.9453 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384,200.9453 L384,210.9453 L394,210.9453 L384,200.9453 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="205" x="174" y="218.0122">2. create random (high entropy)</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="200" x="174" y="233.145">one-time symmetric JWK secret</text><line style="stroke:#A80036;stroke-width:1.0;" x1="414.5" x2="456.5" y1="310.4766" y2="310.4766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="456.5" x2="456.5" y1="310.4766" y2="323.4766"/><line style="stroke:#A80036;stroke-width:1.0;" x1="415.5" x2="456.5" y1="323.4766" y2="323.4766"/><polygon fill="#A80036" points="425.5,319.4766,415.5,323.4766,425.5,327.4766,421.5,323.4766" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="120" x="421.5" y="302.4106">cipherblock=Enc</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="10" lengthAdjust="spacing" textLength="36" x="541.5" y="306.1182">secret</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="56" x="577.5" y="302.4106">(block)</text><path d="M135,281.2109 L135,336.2109 L394,336.2109 L394,291.2109 L384,281.2109 L135,281.2109 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384,281.2109 L384,291.2109 L394,291.2109 L384,281.2109 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="207" x="141" y="298.2778">3. encrypt data block with secret</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="234" x="141" y="313.4106">using agreed encAlg (only AE modes</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="151" x="141" y="328.5435">of operation supported)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="414.5" x2="456.5" y1="392.7422" y2="392.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="456.5" x2="456.5" y1="392.7422" y2="405.7422"/><line style="stroke:#A80036;stroke-width:1.0;" x1="415.5" x2="456.5" y1="405.7422" y2="405.7422"/><polygon fill="#A80036" points="425.5,401.7422,415.5,405.7422,425.5,409.7422,421.5,405.7422" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="136" x="421.5" y="387.6763">Create signed PoO</text><path d="M184,380.1094 L184,405.1094 L394,405.1094 L394,390.1094 L384,380.1094 L184,380.1094 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384,380.1094 L384,390.1094 L394,390.1094 L384,380.1094 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="189" x="190" y="397.1763">4. create proof of origin (PoO)</text><polygon fill="#A80036" points="109.5,471.4414,99.5,475.4414,109.5,479.4414,105.5,475.4414" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="103.5" x2="403.5" y1="475.4414" y2="475.4414"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="160" x="115.5" y="470.3755">{ cipherblock, PoO }</text><path d="M414,448.7422 L414,488.7422 L712,488.7422 L712,458.7422 L702,448.7422 L414,448.7422 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M702,448.7422 L702,458.7422 L712,458.7422 L702,448.7422 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="277" x="420" y="465.8091">5. return cipherblock (the consumer cannot</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="176" x="420" y="480.9419">decrytp it yet), and the PoO</text><line style="stroke:#A80036;stroke-width:1.0;" x1="103.5" x2="145.5" y1="526.7734" y2="526.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="145.5" x2="145.5" y1="526.7734" y2="539.7734"/><line style="stroke:#A80036;stroke-width:1.0;" x1="104.5" x2="145.5" y1="539.7734" y2="539.7734"/><polygon fill="#A80036" points="114.5,535.7734,104.5,539.7734,114.5,543.7734,110.5,539.7734" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="96" x="110.5" y="521.7075">validate PoO</text><path d="M218,499.0078 L218,554.0078 L397,554.0078 L397,509.0078 L387,499.0078 L218,499.0078 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M387,499.0078 L387,509.0078 L397,509.0078 L387,499.0078 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="147" x="224" y="516.0747">6. validate PoO against</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="158" x="224" y="531.2075">received cipherblock and</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="111" x="224" y="546.3403">agreed exchange</text><line style="stroke:#A80036;stroke-width:1.0;" x1="98.5" x2="140.5" y1="610.5391" y2="610.5391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="140.5" x2="140.5" y1="610.5391" y2="623.5391"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="140.5" y1="623.5391" y2="623.5391"/><polygon fill="#A80036" points="109.5,619.5391,99.5,623.5391,109.5,627.5391,105.5,623.5391" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="72" x="105.5" y="605.4731">store PoO</text><path d="M189,597.9063 L189,622.9063 L289,622.9063 L289,607.9063 L279,597.9063 L189,597.9063 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M279,597.9063 L279,607.9063 L289,607.9063 L279,597.9063 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="79" x="195" y="614.9731">7. store PoO</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="825.5" x="0" y="652.1055"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="825.5" y1="652.1055" y2="652.1055"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="825.5" y1="655.1055" y2="655.1055"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="401" x="212.25" y="641.5391"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="382" x="218.25" y="657.606">step 2: consumer sends a Proof of Reception (PoR)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="103.5" x2="145.5" y1="699.8711" y2="699.8711"/><line style="stroke:#A80036;stroke-width:1.0;" x1="145.5" x2="145.5" y1="699.8711" y2="712.8711"/><line style="stroke:#A80036;stroke-width:1.0;" x1="104.5" x2="145.5" y1="712.8711" y2="712.8711"/><polygon fill="#A80036" points="114.5,708.8711,104.5,712.8711,114.5,716.8711,110.5,712.8711" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="136" x="110.5" y="694.8052">Create signed PoR</text><path d="M258,679.6719 L258,719.6719 L389,719.6719 L389,689.6719 L379,679.6719 L258,679.6719 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M379,679.6719 L379,689.6719 L389,689.6719 L379,679.6719 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="110" x="264" y="696.7388">8. create proof of</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="98" x="264" y="711.8716">reception (PoR)</text><polygon fill="#A80036" points="387.5,772.0703,397.5,776.0703,387.5,780.0703,391.5,776.0703" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="98.5" x2="393.5" y1="776.0703" y2="776.0703"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="24" x="105.5" y="771.0044">PoR</text><line style="stroke:#A80036;stroke-width:1.0;" x1="409.5" x2="451.5" y1="805.2031" y2="805.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="451.5" x2="451.5" y1="805.2031" y2="818.2031"/><line style="stroke:#A80036;stroke-width:1.0;" x1="410.5" x2="451.5" y1="818.2031" y2="818.2031"/><polygon fill="#A80036" points="420.5,814.2031,410.5,818.2031,420.5,822.2031,416.5,818.2031" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="96" x="416.5" y="800.1372">validate PoR</text><path d="M279,792.5703 L279,817.5703 L394,817.5703 L394,802.5703 L384,792.5703 L279,792.5703 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384,792.5703 L384,802.5703 L394,802.5703 L384,792.5703 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="94" x="285" y="809.6372">9. validate PoR</text><line style="stroke:#A80036;stroke-width:1.0;" x1="409.5" x2="451.5" y1="866.5352" y2="866.5352"/><line style="stroke:#A80036;stroke-width:1.0;" x1="451.5" x2="451.5" y1="866.5352" y2="879.5352"/><line style="stroke:#A80036;stroke-width:1.0;" x1="410.5" x2="451.5" y1="879.5352" y2="879.5352"/><polygon fill="#A80036" points="420.5,875.5352,410.5,879.5352,420.5,883.5352,416.5,879.5352" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="80" x="416.5" y="861.4692">store PoR.</text><path d="M134,831.2031 L134,901.2031 L394,901.2031 L394,841.2031 L384,831.2031 L134,831.2031 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384,831.2031 L384,841.2031 L394,841.2031 L384,831.2031 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="89" x="140" y="848.27">10. store PoR.</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="218" x="140" y="863.4028">The PoR is non-repudiable proof of</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="239" x="140" y="878.5356">the consumer being commited to get</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="235" x="140" y="893.6685">the secret to decrypt the cipherblock</text><rect fill="#EEEEEE" height="3" style="stroke:#EEEEEE;stroke-width:1.0;" width="825.5" x="0" y="927.3008"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="825.5" y1="927.3008" y2="927.3008"/><line style="stroke:#000000;stroke-width:1.0;" x1="0" x2="825.5" y1="930.3008" y2="930.3008"/><rect fill="#EEEEEE" height="23.1328" style="stroke:#000000;stroke-width:2.0;" width="599" x="113.25" y="916.7344"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="580" x="119.25" y="932.8013">step 3: provider publishes the secret, and consumer decrypts the cipherblock</text><polygon fill="#A80036" points="733.5,992.6992,743.5,996.6992,733.5,1000.6992,737.5,996.6992" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="409.5" x2="739.5" y1="996.6992" y2="996.6992"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="312" x="416.5" y="991.6333">call sc setregistry(exchangeId, secret)</text><path d="M78,954.8672 L78,1024.8672 L394,1024.8672 L394,964.8672 L384,954.8672 L78,954.8672 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384,954.8672 L384,964.8672 L394,964.8672 L384,954.8672 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="261" x="84" y="971.9341">11. Provider publishes secret on the DLT.</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="291" x="84" y="987.0669">The one-time secret that was used to encrypt</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="270" x="84" y="1002.1997">the block is published to the DLT using the</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="204" x="84" y="1017.3325">non-repudiation smart contract.</text><line style="stroke:#A80036;stroke-width:1.0;" x1="409.5" x2="451.5" y1="1100.9961" y2="1100.9961"/><line style="stroke:#A80036;stroke-width:1.0;" x1="451.5" x2="451.5" y1="1100.9961" y2="1113.9961"/><line style="stroke:#A80036;stroke-width:1.0;" x1="410.5" x2="451.5" y1="1113.9961" y2="1113.9961"/><polygon fill="#A80036" points="420.5,1109.9961,410.5,1113.9961,420.5,1117.9961,416.5,1113.9961" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="136" x="416.5" y="1095.9302">Create signed PoP</text><path d="M114,1035.3984 L114,1166.3984 L394,1166.3984 L394,1045.3984 L384,1035.3984 L114,1035.3984 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384,1035.3984 L384,1045.3984 L394,1045.3984 L384,1035.3984 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="185" x="120" y="1052.4653">12. Provider creates the PoP.</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="254" x="120" y="1067.5981">A proof of publication ("PoP") is created,</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="259" x="120" y="1082.731">but only to accelarate the process, since</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="240" x="120" y="1097.8638">the actual PoP is the secret published</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="233" x="120" y="1112.9966">with the smart contract. In any case,</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="233" x="120" y="1128.1294">receiving the PoP is likely faster than</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="256" x="120" y="1143.2622">waiting for the secret to be published on</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="53" x="120" y="1158.395">the DLT.</text><polygon fill="#A80036" points="109.5,1188.5938,99.5,1192.5938,109.5,1196.5938,105.5,1192.5938" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="103.5" x2="398.5" y1="1192.5938" y2="1192.5938"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="24" x="115.5" y="1187.5278">PoP</text><path d="M103,1205.5938 L103,1230.5938 L383,1230.5938 L383,1215.5938 L373,1205.5938 L103,1205.5938 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M373,1205.5938 L373,1215.5938 L383,1215.5938 L373,1205.5938 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="259" x="109" y="1222.6606">13. Consumer gets the secret in the PoP</text><path d="M10,1242.7266 L80,1242.7266 L80,1249.7266 L70,1259.7266 L10,1259.7266 L10,1242.7266 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="260.7266" style="stroke:#000000;stroke-width:2.0;" width="805.5" x="10" y="1242.7266"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="25" y="1255.7935">opt</text><text fill="#000000" font-family="DejaVu Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="192" x="95" y="1254.937">[no response || lost response]</text><line style="stroke:#A80036;stroke-width:2.0;" x1="104.5" x2="114.5" y1="1275.9922" y2="1285.9922"/><line style="stroke:#A80036;stroke-width:2.0;" x1="104.5" x2="114.5" y1="1285.9922" y2="1275.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="110.5" x2="398.5" y1="1280.9922" y2="1280.9922"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="24" x="115.5" y="1275.9263">PoP</text><path d="M103,1293.9922 L103,1439.9922 L414,1439.9922 L414,1303.9922 L404,1293.9922 L103,1293.9922 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M404,1293.9922 L404,1303.9922 L414,1303.9922 L404,1293.9922 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="290" x="109" y="1311.0591">13.5. If the PoP is not received, the consumer</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="227" x="109" y="1326.1919">downloads the secret from the DLT.</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="0" x="113" y="1341.3247"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="288" x="109" y="1356.4575">With the PoR, the consumer commited to get</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="279" x="109" y="1371.5903">the secret from the DLT even if the PoP was</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="83" x="109" y="1386.7231">not received.</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="261" x="109" y="1401.856">In any case, there is a predefined/agreed</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="82" x="109" y="1416.9888">max timeout</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="128" x="195" y="1416.9888">pooToSecretDelay</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="42" x="327" y="1416.9888">to wait</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="42" x="109" y="1432.1216">for the</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="48" x="155" y="1432.1216">secret</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="166" x="207" y="1432.1216">to be avalaible on the DLT</text><polygon fill="#A80036" points="728.5,1462.3203,738.5,1466.3203,728.5,1470.3203,732.5,1466.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="98.5" x2="734.5" y1="1466.3203" y2="1466.3203"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="424" x="105.5" y="1461.2544">getSecret (exchange.ledgerSignerAddress, exchange.id)</text><polygon fill="#A80036" points="109.5,1491.4531,99.5,1495.4531,109.5,1499.4531,105.5,1495.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="103.5" x2="744.5" y1="1495.4531" y2="1495.4531"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="48" x="115.5" y="1490.3872">secret</text><line style="stroke:#A80036;stroke-width:1.0;" x1="98.5" x2="140.5" y1="1546.7188" y2="1546.7188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="140.5" x2="140.5" y1="1546.7188" y2="1559.7188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="140.5" y1="1559.7188" y2="1559.7188"/><polygon fill="#A80036" points="109.5,1555.7188,99.5,1559.7188,109.5,1563.7188,105.5,1559.7188" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="216" x="105.5" y="1526.52">verify that hash(secret) ==</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="232" x="105.5" y="1541.6528">PoO.exchange.secretCommitment</text><path d="M349,1526.5195 L349,1551.5195 L603,1551.5195 L603,1536.5195 L593,1526.5195 L349,1526.5195 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M593,1526.5195 L593,1536.5195 L603,1536.5195 L593,1526.5195 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="233" x="355" y="1543.5864">14. The consumer verifies the secret</text><line style="stroke:#A80036;stroke-width:1.0;" x1="98.5" x2="140.5" y1="1606.9844" y2="1606.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="140.5" x2="140.5" y1="1606.9844" y2="1619.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="99.5" x2="140.5" y1="1619.9844" y2="1619.9844"/><polygon fill="#A80036" points="109.5,1615.9844,99.5,1619.9844,109.5,1623.9844,105.5,1619.9844" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="256" x="105.5" y="1583.7856">decrypt cipherblock with secret:</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="144" x="113.5" y="1598.9185">decryptedBlock=Dec</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="10" lengthAdjust="spacing" textLength="36" x="257.5" y="1602.626">secret</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="104" x="293.5" y="1598.9185">(cipherblock)</text><path d="M409,1585.2852 L409,1610.2852 L709,1610.2852 L709,1595.2852 L699,1585.2852 L409,1585.2852 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M699,1585.2852 L699,1595.2852 L709,1595.2852 L699,1585.2852 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="279" x="415" y="1602.3521">15. The consumer decrypts the cipherblock.</text><!--MD5=[2b5d26979bb8b8495596beeb5e654d66]
@startuml nrpOverview
skinparam shadowing false
skinparam DefaultFontName DejaVu Sans
skinparam DefaultMonospacedFontName DejaVu Sans Mono
skinparam ArrowFontName DejaVu Sans Mono
skinparam maxMessageSize 450

title i3-MARKET non-repudiation protocol

box "i3M Consumer" #White
  participant "Consumer: SDA SDK" as C #99FF99
end box
box "i3M Provider" #White
  participant "SDA API\n: Data Transfer Manager" as P #FFAAAA
end box
box "i3M Backplane\n" #FBFBFF
  participant "i3-MARKET DLT" as DLT
end box

== step 1: consumer gets cipherblock and non-repudiable Proof of Origin (PoO) ==
C->P++: GET data {id?: <block_id>}
note right #E9FFE9
  1. query a block of data
end note
  P->P++: create one-time secret
  P- -
  note left #FFE9E9
    2. create random (high entropy)
    one-time symmetric JWK secret
  end note
  P->P++: cipherblock=Enc<sub>secret</sub>(block)
  P- -
  note left #FFE9E9
    3. encrypt data block with secret
    using agreed encAlg (only AE modes 
    of operation supported)
  end note
  P->P++: Create signed PoO
  note left #FFE9E9
    4. create proof of origin (PoO)
  end note
  P- -
return { cipherblock, PoO }
note right #FFE9E9
  5. return cipherblock (the consumer cannot
  decrytp it yet), and the PoO
end note

C->C++: validate PoO
C- -
note right #E9FFE9
  6. validate PoO against
  received cipherblock and
  agreed exchange
end note

C->C: store PoO
note right #E9FFE9
  7. store PoO
end note

== step 2: consumer sends a Proof of Reception (PoR) ==

C->C++: Create signed PoR
note right #E9FFE9
  8. create proof of
  reception (PoR)
end note
C- -

C->P++: PoR
P->P: validate PoR
note left #FFE9E9
  9. validate PoR
end note

P->P: store PoR.
note left #FFE9E9
  10. store PoR.
  The PoR is non-repudiable proof of
  the consumer being commited to get
  the secret to decrypt the cipherblock
end note

== step 3: provider publishes the secret, and consumer decrypts the cipherblock ==

P->DLT: call sc setregistry(exchangeId, secret)
note left #FFE9E9
  11. Provider publishes secret on the DLT.
  The one-time secret that was used to encrypt 
  the block is published to the DLT using the 
  non-repudiation smart contract.
end note

P->P: Create signed PoP
note left #FFE9E9
  12. Provider creates the PoP.
  A proof of publication ("PoP") is created, 
  but only to accelarate the process, since
  the actual PoP is the secret published 
  with the smart contract. In any case,
  receiving the PoP is likely faster than
  waiting for the secret to be published on
  the DLT.
end note
P- ->C: PoP

note right of C #E9FFE9
  13. Consumer gets the secret in the PoP
end note

opt no response || lost response
  P - ->x C: PoP
  note right of C #E9FFE9
    13.5. If the PoP is not received, the consumer
    downloads the secret from the DLT.

    With the PoR, the consumer commited to get
    the secret from the DLT even if the PoP was
    not received.
    In any case, there is a predefined/agreed
    max timeout ""pooToSecretDelay"" to wait
    for the ""secret"" to be avalaible on the DLT
  end note
  C->DLT++: getSecret (exchange.ledgerSignerAddress, exchange.id)
  return secret
end
  
C->C: verify that hash(secret) == PoO.exchange.secretCommitment
note right #E9FFE9
  14. The consumer verifies the secret
end note

C->C: decrypt cipherblock with secret:\n decryptedBlock=Dec<sub>secret</sub>(cipherblock)
note right #E9FFE9
  15. The consumer decrypts the cipherblock.
end note
@enduml

PlantUML version 1.2021.16(Wed Dec 08 18:25:22 CET 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>