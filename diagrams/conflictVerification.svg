<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="915px" preserveAspectRatio="none" style="width:1005px;height:915px;background:#FFFFFF;" version="1.1" viewBox="0 0 1005 915" width="1005px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="DejaVu Sans" font-size="18" lengthAdjust="spacing" textLength="557" x="221.5" y="28.708">i3-MARKET conflict resolution: verification (NRP completeness)</text><rect fill="#FFFFFF" height="868.8359" style="stroke:#A80036;stroke-width:1.0;" width="188" x="1" y="40.9531"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="93" x="48.5" y="53.02">i3M Provider</text><rect fill="#FBFBFF" height="868.8359" style="stroke:#A80036;stroke-width:1.0;" width="644.5" x="354.5" y="40.9531"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="108" x="622.75" y="53.02">i3M Backplane</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="0" x="679.25" y="68.1528"/><rect fill="#FFFFFF" height="455.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="450" y="385.5391"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="930" y="529.2031"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="95" x2="95" y1="122.8125" y2="859.1953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="454.5" x2="454.5" y1="122.8125" y2="859.1953"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="935" x2="935" y1="122.8125" y2="859.1953"/><rect fill="#FFAAAA" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="180" x="5" y="75.2188"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="54" x="68" y="95.2139">SDA API</text><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="166" x="12" y="111.5107">: Data Transfer Manager</text><rect fill="#FFAAAA" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="180" x="5" y="858.1953"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="54" x="68" y="878.1904">SDA API</text><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="166" x="12" y="894.4873">: Data Transfer Manager</text><rect fill="#A9A9FF" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="193" x="358.5" y="75.2188"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="97" x="406.5" y="95.2139">Backplane API</text><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="179" x="365.5" y="111.5107">: Conflict-Resolver Service</text><rect fill="#A9A9FF" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="193" x="358.5" y="858.1953"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="97" x="406.5" y="878.1904">Backplane API</text><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="179" x="365.5" y="894.4873">: Conflict-Resolver Service</text><rect fill="#FEFECE" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="120" x="875" y="91.5156"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="106" x="882" y="111.5107">i3-MARKET DLT</text><rect fill="#FEFECE" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="120" x="875" y="858.1953"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="106" x="882" y="878.1904">i3-MARKET DLT</text><rect fill="#FFFFFF" height="455.6563" style="stroke:#A80036;stroke-width:1.0;" width="10" x="450" y="385.5391"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#A80036;stroke-width:1.0;" width="10" x="930" y="529.2031"/><path d="M100,137.8125 L100,207.8125 L391,207.8125 L391,147.8125 L381,137.8125 L100,137.8125 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M381,137.8125 L381,147.8125 L391,147.8125 L381,137.8125 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="270" x="106" y="154.8794">For every invoiced block, a provider should</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="229" x="106" y="170.0122">attach a signed proof (resolution) of</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="220" x="106" y="185.145">verification of completeness of the</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="157" x="106" y="200.2778">non-repudiation protocol</text><line style="stroke:#A80036;stroke-width:1.0;" x1="95" x2="137" y1="343.4063" y2="343.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="137" x2="137" y1="343.4063" y2="356.4063"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="137" y1="356.4063" y2="356.4063"/><polygon fill="#A80036" points="106,352.4063,96,356.4063,106,360.4063,102,356.4063" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="256" x="102" y="229.4106">create verificationRequest = JWS</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="10" lengthAdjust="spacing" textLength="48" x="358" y="233.1182">consumer</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="16" x="406" y="229.4106">({</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="160" x="118" y="247.5435">proofType: 'request'</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="88" x="118" y="262.6763">iss: 'dest'</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="240" x="118" y="277.8091">iat: number // NumericDate now</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="312" x="118" y="292.9419">por: string // the PoR as a compact JWS</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="176" x="118" y="308.0747">dataExchangeId: string</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="216" x="118" y="323.2075">type: 'verificationRequest'</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="16" x="102" y="338.3403">})</text><polygon fill="#A80036" points="438,381.5391,448,385.5391,438,389.5391,442,385.5391" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="95" x2="444" y1="385.5391" y2="385.5391"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="336" x="102" y="380.4731">POST /verification { verificationRequest }</text><line style="stroke:#A80036;stroke-width:1.0;" x1="460" x2="502" y1="414.6719" y2="414.6719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="502" x2="502" y1="414.6719" y2="427.6719"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461" x2="502" y1="427.6719" y2="427.6719"/><polygon fill="#A80036" points="471,423.6719,461,427.6719,471,431.6719,467,427.6719" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="264" x="467" y="409.606">verify PoR in verificationRequest</text><line style="stroke:#A80036;stroke-width:1.0;" x1="460" x2="502" y1="471.9375" y2="471.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="502" x2="502" y1="471.9375" y2="484.9375"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461" x2="502" y1="484.9375" y2="484.9375"/><polygon fill="#A80036" points="471,480.9375,461,484.9375,471,488.9375,467,484.9375" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="432" x="467" y="451.7388">verify verificationRequest using por.exchange.orig JWK</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="184" x="467" y="466.8716">(provider's public key)</text><polygon fill="#A80036" points="918,525.2031,928,529.2031,918,533.2031,922,529.2031" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="460" x2="924" y1="529.2031" y2="529.2031"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="352" x="467" y="509.0044">getSecret (por.exchange.ledgerSignerAddress,</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="128" x="467" y="524.1372">por.exchange.id)</text><polygon fill="#A80036" points="471,554.3359,461,558.3359,471,562.3359,467,558.3359" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="465" x2="934" y1="558.3359" y2="558.3359"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="168" x="477" y="553.27">{ secret, secretIat }</text><line style="stroke:#A80036;stroke-width:1.0;" x1="460" x2="502" y1="632.8672" y2="632.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="502" x2="502" y1="632.8672" y2="645.8672"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461" x2="502" y1="645.8672" y2="645.8672"/><polygon fill="#A80036" points="471,641.8672,461,645.8672,471,649.8672,467,645.8672" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="56" x="467" y="582.4028">verify:</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="176" x="475" y="597.5356">secret is published &amp;&amp;</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="200" x="475" y="612.6685">secretIat &lt; por.poo.iat +</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="264" x="467" y="627.8013">por.poo.exchange.pooToSecretDelay</text><line style="stroke:#A80036;stroke-width:1.0;" x1="460" x2="502" y1="799.0625" y2="799.0625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="502" x2="502" y1="799.0625" y2="812.0625"/><line style="stroke:#A80036;stroke-width:1.0;" x1="461" x2="502" y1="812.0625" y2="812.0625"/><polygon fill="#A80036" points="471,808.0625,461,812.0625,471,816.0625,467,812.0625" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="176" x="467" y="669.9341">signedResolution = JWS</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="10" lengthAdjust="spacing" textLength="18" x="643" y="673.6416">CRS</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="16" x="661" y="669.9341">({</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="184" x="483" y="688.0669">proofType: 'resolution'</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="160" x="483" y="703.1997">type: 'verification'</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="328" x="483" y="718.3325">resolution: 'completed' | 'not completed'</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="440" x="483" y="733.4653">dataExchangeId: verificationRequest.por.poo.exchange.id</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="240" x="483" y="748.5981">iat: number // NumericDate now</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="376" x="483" y="763.731">iss: string // the public key of the CRS in JWK</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="360" x="483" y="778.8638">sub: string // the public JWK of the consumer</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="16" x="467" y="793.9966">})</text><path d="M123,694.1328 L123,779.1328 L445,779.1328 L445,704.1328 L435,694.1328 L123,694.1328 " fill="#E9E9FF" style="stroke:#A80036;stroke-width:1.0;"/><path d="M435,694.1328 L435,704.1328 L445,704.1328 L435,694.1328 " fill="#E9E9FF" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="299" x="129" y="711.1997">Resolution is 'completed' if the non-repudiation</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="301" x="129" y="726.3325">protocol for this exchange is complete: i.e. that</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="280" x="129" y="741.4653">the PoR has been properly verified, and that</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="275" x="129" y="756.5981">the secret was published in time; otherwise</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="184" x="129" y="771.731">resolution is 'not completed'.</text><polygon fill="#A80036" points="106,837.1953,96,841.1953,106,845.1953,102,841.1953" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100" x2="454" y1="841.1953" y2="841.1953"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="160" x="112" y="836.1294">{ signedResolution }</text><!--MD5=[85597c06dd7abc1035edeae7b37cf7d2]
@startuml conflictVerification
skinparam shadowing false
skinparam DefaultFontName DejaVu Sans
skinparam DefaultMonospacedFontName DejaVu Sans Mono
skinparam ArrowFontName DejaVu Sans Mono
skinparam maxMessageSize 460

title "i3-MARKET conflict resolution: verification (NRP completeness)"

box "i3M Provider" #White
  participant "SDA API\n: Data Transfer Manager" as P #FFAAAA
end box
box "i3M Backplane\n" #FBFBFF
  participant "Backplane API\n: Conflict-Resolver Service" as CRS #A9A9FF
  participant "i3-MARKET DLT" as DLT
end box

note right of P #FFE9E9
  For every invoiced block, a provider should
  attach a signed proof (resolution) of
  verification of completeness of the 
  non-repudiation protocol
end note

P->P: create verificationRequest = JWS<sub>consumer</sub>({\n  proofType: 'request'\n  iss: 'dest'\n  iat: number // NumericDate now\n  por: string // the PoR as a compact JWS\n  dataExchangeId: string\n  type: 'verificationRequest'\n})
P->CRS++: POST /verification { verificationRequest }
CRS->CRS: verify PoR in verificationRequest
CRS->CRS: verify verificationRequest using por.exchange.orig JWK (provider's public key)
CRS->DLT++: getSecret (por.exchange.ledgerSignerAddress, por.exchange.id)
return { secret, secretIat }
CRS->CRS: verify:\n secret is published &&\n secretIat < por.poo.iat + por.poo.exchange.pooToSecretDelay
CRS->CRS: signedResolution = JWS<sub>CRS</sub>({\n  proofType: 'resolution'\n  type: 'verification'\n  resolution: 'completed' | 'not completed'\n  dataExchangeId: verificationRequest.por.poo.exchange.id\n  iat: number // NumericDate now\n  iss: string // the public key of the CRS in JWK\n  sub: string // the public JWK of the consumer\n})
note left #E9E9FF
  Resolution is 'completed' if the non-repudiation
  protocol for this exchange is complete: i.e. that
  the PoR has been properly verified, and that
  the secret was published in time; otherwise
  resolution is 'not completed'.
end note
return { signedResolution }

@enduml

PlantUML version 1.2021.16(Wed Dec 08 18:25:22 CET 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>