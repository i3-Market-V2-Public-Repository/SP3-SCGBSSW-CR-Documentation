<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1187px" preserveAspectRatio="none" style="width:792px;height:1187px;background:#FFFFFF;" version="1.1" viewBox="0 0 792 1187" width="792px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="DejaVu Sans" font-size="18" lengthAdjust="spacing" textLength="767" x="9" y="28.708">i3M NRP - step 1: consumer gets cipherblock and non-repudiable Proof of Origin (PoO)</text><rect fill="#FFFFFF" height="1140.4297" style="stroke:#A80036;stroke-width:1.0;" width="93" x="49.25" y="40.9531"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="74" x="58.75" y="53.02">Consumer</text><rect fill="#FFFFFF" height="1140.4297" style="stroke:#A80036;stroke-width:1.0;" width="188" x="233.75" y="40.9531"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="62" x="296.75" y="53.02">Provider</text><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="90.75" y="963.7578"/><rect fill="#FFFFFF" height="762.6133" style="stroke:#A80036;stroke-width:1.0;" width="10" x="322.75" y="141.8125"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="327.75" y="186.0117"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="327.75" y="275.3438"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="327.75" y="829.7266"/><rect fill="#FFFFFF" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="384.5" x="43.25" y="1025.3906"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="95.25" x2="95.25" y1="107.6797" y2="1130.7891"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="327.75" x2="327.75" y1="107.6797" y2="1130.7891"/><rect fill="#99FF99" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="85" x="53.25" y="76.3828"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="71" x="60.25" y="96.3779">: SDA SDK</text><rect fill="#99FF99" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="85" x="53.25" y="1129.7891"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="71" x="60.25" y="1149.7842">: SDA SDK</text><rect fill="#FFAAAA" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="180" x="237.75" y="60.0859"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="54" x="300.75" y="80.0811">SDA API</text><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="166" x="244.75" y="96.3779">: Data Transfer Manager</text><rect fill="#FFAAAA" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="180" x="237.75" y="1129.7891"/><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="54" x="300.75" y="1149.7842">SDA API</text><text fill="#000000" font-family="DejaVu Sans" font-size="14" lengthAdjust="spacing" textLength="166" x="244.75" y="1166.0811">: Data Transfer Manager</text><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="90.75" y="963.7578"/><rect fill="#FFFFFF" height="762.6133" style="stroke:#A80036;stroke-width:1.0;" width="10" x="322.75" y="141.8125"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="327.75" y="186.0117"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="327.75" y="275.3438"/><rect fill="#FFFFFF" height="28" style="stroke:#A80036;stroke-width:1.0;" width="10" x="327.75" y="829.7266"/><polygon fill="#A80036" points="310.75,137.8125,320.75,141.8125,310.75,145.8125,314.75,141.8125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="95.75" x2="316.75" y1="141.8125" y2="141.8125"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="208" x="102.75" y="136.7466">GET data {id?: &lt;block_id&gt;}</text><path d="M337.25,122.6797 L337.25,147.6797 L508.25,147.6797 L508.25,132.6797 L498.25,122.6797 L337.25,122.6797 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M498.25,122.6797 L498.25,132.6797 L508.25,132.6797 L498.25,122.6797 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="150" x="343.25" y="139.7466">1. query a block of data</text><line style="stroke:#A80036;stroke-width:1.0;" x1="337.75" x2="379.75" y1="178.0117" y2="178.0117"/><line style="stroke:#A80036;stroke-width:1.0;" x1="379.75" x2="379.75" y1="178.0117" y2="191.0117"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338.75" x2="379.75" y1="191.0117" y2="191.0117"/><polygon fill="#A80036" points="348.75,187.0117,338.75,191.0117,348.75,195.0117,344.75,191.0117" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="176" x="344.75" y="172.9458">create one-time secret</text><path d="M91.25,157.8125 L91.25,197.8125 L317.25,197.8125 L317.25,167.8125 L307.25,157.8125 L91.25,157.8125 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M307.25,157.8125 L307.25,167.8125 L317.25,167.8125 L307.25,157.8125 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="205" x="97.25" y="174.8794">2. create random (high entropy)</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="200" x="97.25" y="190.0122">one-time symmetric JWK secret</text><line style="stroke:#A80036;stroke-width:1.0;" x1="337.75" x2="379.75" y1="267.3438" y2="267.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="379.75" x2="379.75" y1="267.3438" y2="280.3438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338.75" x2="379.75" y1="280.3438" y2="280.3438"/><polygon fill="#A80036" points="348.75,276.3438,338.75,280.3438,348.75,284.3438,344.75,280.3438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="120" x="344.75" y="259.2778">cipherblock=Enc</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="10" lengthAdjust="spacing" textLength="36" x="464.75" y="262.9854">secret</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="56" x="500.75" y="259.2778">(block)</text><path d="M58.25,238.0781 L58.25,293.0781 L317.25,293.0781 L317.25,248.0781 L307.25,238.0781 L58.25,238.0781 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M307.25,238.0781 L307.25,248.0781 L317.25,248.0781 L307.25,238.0781 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="207" x="64.25" y="255.145">3. encrypt data block with secret</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="234" x="64.25" y="270.2778">using agreed encAlg (only AE modes</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="151" x="64.25" y="285.4106">of operation supported)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="337.75" x2="379.75" y1="821.7266" y2="821.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="379.75" x2="379.75" y1="821.7266" y2="834.7266"/><line style="stroke:#A80036;stroke-width:1.0;" x1="338.75" x2="379.75" y1="834.7266" y2="834.7266"/><polygon fill="#A80036" points="348.75,830.7266,338.75,834.7266,348.75,838.7266,344.75,834.7266" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="56" x="344.75" y="344.5435">PoO=JWS</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="10" lengthAdjust="spacing" textLength="48" x="400.75" y="348.251">provider</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="16" x="448.75" y="344.5435">({</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="96" x="360.75" y="362.6763">iss: 'orig',</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="136" x="360.75" y="377.8091">proofType: 'PoO',</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="168" x="360.75" y="392.9419">iat: &lt;timestamp_now&gt;,</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="88" x="360.75" y="408.0747">exchange: {</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="80" x="376.75" y="423.2075">id: string</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="368" x="376.75" y="438.3403">orig: string // Public key as a compact JWK of</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="96" x="344.75" y="453.4731">the provider</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="368" x="376.75" y="468.606">dest: string // Public key as a compact JWK of</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="96" x="344.75" y="483.7388">the consumer</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="320" x="376.75" y="498.8716">hashAlg: string // agreed hash algorithm</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="360" x="376.75" y="514.0044">encAlg: string // agreed encryption algorithm</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="320" x="376.75" y="529.1372">signingAlg: string // agreed JWS signing</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="72" x="344.75" y="544.27">algorithm</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="328" x="376.75" y="559.4028">ledgerContractAddress: string // contract</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="56" x="344.75" y="574.5356">address</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="360" x="376.75" y="589.6685">ledgerSignerAddress: string // address of the</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="144" x="344.75" y="604.8013">orig in the ledger</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="328" x="376.75" y="619.9341">pooToPorDelay: number // max milliseconds</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="280" x="344.75" y="635.0669">between issued PoO and verified PoR</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="352" x="376.75" y="650.1997">pooToSecretDelay: number // max milliseconds</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="368" x="344.75" y="665.3325">between issued PoO and secret published on the</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="48" x="344.75" y="680.4653">ledger</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="360" x="376.75" y="695.5981">schema?: string // an optional schema. In the</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="400" x="344.75" y="710.731">future it will be used to check the decrypted data</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="304" x="376.75" y="725.8638">cipherblockDgst: string // hash of the</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="320" x="344.75" y="740.9966">cipherblock in base64url with no padding</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="368" x="376.75" y="756.1294">secretCommitment: string // hash of the secret</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="400" x="344.75" y="771.2622">that can be used to decrypt the block in base64url</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="120" x="344.75" y="786.395">with no padding</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="8" x="360.75" y="801.5278">}</text><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="16" x="344.75" y="816.6606">})</text><path d="M107.25,573.0352 L107.25,598.0352 L317.25,598.0352 L317.25,583.0352 L307.25,573.0352 L107.25,573.0352 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M307.25,573.0352 L307.25,583.0352 L317.25,583.0352 L307.25,573.0352 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="189" x="113.25" y="590.1021">4. create proof of origin (PoO)</text><polygon fill="#A80036" points="106.75,900.4258,96.75,904.4258,106.75,908.4258,102.75,904.4258" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="100.75" x2="326.75" y1="904.4258" y2="904.4258"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="160" x="112.75" y="899.3599">{ cipherblock, PoO }</text><path d="M337.25,877.7266 L337.25,917.7266 L635.25,917.7266 L635.25,887.7266 L625.25,877.7266 L337.25,877.7266 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M625.25,877.7266 L625.25,887.7266 L635.25,887.7266 L625.25,877.7266 " fill="#FFE9E9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="277" x="343.25" y="894.7935">5. return cipherblock (the consumer cannot</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="176" x="343.25" y="909.9263">decrytp it yet), and the PoO</text><line style="stroke:#A80036;stroke-width:1.0;" x1="100.75" x2="142.75" y1="955.7578" y2="955.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="142.75" x2="142.75" y1="955.7578" y2="968.7578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101.75" x2="142.75" y1="968.7578" y2="968.7578"/><polygon fill="#A80036" points="111.75,964.7578,101.75,968.7578,111.75,972.7578,107.75,968.7578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="96" x="107.75" y="950.6919">validate PoO</text><path d="M215.25,927.9922 L215.25,982.9922 L394.25,982.9922 L394.25,937.9922 L384.25,927.9922 L215.25,927.9922 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M384.25,927.9922 L384.25,937.9922 L394.25,937.9922 L384.25,927.9922 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="147" x="221.25" y="945.0591">6. validate PoO against</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="158" x="221.25" y="960.1919">received cipherblock and</text><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="111" x="221.25" y="975.3247">agreed exchange</text><path d="M43.25,1025.3906 L113.25,1025.3906 L113.25,1032.3906 L103.25,1042.3906 L43.25,1042.3906 L43.25,1025.3906 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="46.2656" style="stroke:#000000;stroke-width:2.0;" width="384.5" x="43.25" y="1025.3906"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="58.25" y="1038.4575">opt</text><text fill="#000000" font-family="DejaVu Sans" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="83" x="128.25" y="1037.6011">[invalid PoO]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="325.75" x2="315.75" y1="1063.6563" y2="1059.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="325.75" x2="315.75" y1="1063.6563" y2="1067.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="95.75" x2="326.75" y1="1063.6563" y2="1063.6563"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="72" x="102.75" y="1058.5903">terminate</text><line style="stroke:#A80036;stroke-width:2.0;" x1="318.75" x2="336.75" y1="1054.6563" y2="1072.6563"/><line style="stroke:#A80036;stroke-width:2.0;" x1="318.75" x2="336.75" y1="1072.6563" y2="1054.6563"/><line style="stroke:#A80036;stroke-width:1.0;" x1="95.75" x2="137.75" y1="1099.7891" y2="1099.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="137.75" x2="137.75" y1="1099.7891" y2="1112.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96.75" x2="137.75" y1="1112.7891" y2="1112.7891"/><polygon fill="#A80036" points="106.75,1108.7891,96.75,1112.7891,106.75,1116.7891,102.75,1112.7891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans Mono" font-size="13" lengthAdjust="spacing" textLength="72" x="102.75" y="1094.7231">store PoO</text><path d="M186.25,1087.1563 L186.25,1112.1563 L286.25,1112.1563 L286.25,1097.1563 L276.25,1087.1563 L186.25,1087.1563 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><path d="M276.25,1087.1563 L276.25,1097.1563 L286.25,1097.1563 L276.25,1087.1563 " fill="#E9FFE9" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="DejaVu Sans" font-size="13" lengthAdjust="spacing" textLength="79" x="192.25" y="1104.2231">7. store PoO</text><!--MD5=[fb094bdc3bd1d987ba7aee8a98505502]
@startuml nrpStep1
skinparam shadowing false
skinparam DefaultFontName DejaVu Sans
skinparam DefaultMonospacedFontName DejaVu Sans Mono
skinparam ArrowFontName DejaVu Sans Mono
skinparam maxMessageSize 400

title "i3M NRP - step 1: consumer gets cipherblock and non-repudiable Proof of Origin (PoO)"

box "Consumer" #White
  participant ": SDA SDK" as C #99FF99
end box
box "Provider" #White
  participant "SDA API\n: Data Transfer Manager" as P #FFAAAA
end box

C->P++: GET data {id?: <block_id>}
note right #E9FFE9
  1. query a block of data
end note
  P->P++: create one-time secret
  P- -
  note left #FFE9E9
    2. create random (high entropy)
    one-time symmetric JWK secret
  end note
  P->P++: cipherblock=Enc<sub>secret</sub>(block)
  P- -
  note left #FFE9E9
    3. encrypt data block with secret
    using agreed encAlg (only AE modes 
    of operation supported)
  end note
  P->P++: PoO=JWS<sub>provider</sub>({\n  iss: 'orig',\n  proofType: 'PoO',\n  iat: <timestamp_now>,\n  exchange: {\n    id: string \n    orig: string // Public key as a compact JWK of the provider\n    dest: string // Public key as a compact JWK of the consumer\n    hashAlg: string // agreed hash algorithm \n    encAlg: string // agreed encryption algorithm\n    signingAlg: string // agreed JWS signing algorithm \n    ledgerContractAddress: string // contract address \n    ledgerSignerAddress: string // address of the orig in the ledger \n    pooToPorDelay: number // max milliseconds between issued PoO and verified PoR \n    pooToSecretDelay: number // max milliseconds between issued PoO and secret published on the ledger \n    schema?: string // an optional schema. In the future it will be used to check the decrypted data \n    cipherblockDgst: string // hash of the cipherblock in base64url with no padding \n    secretCommitment: string // hash of the secret that can be used to decrypt the block in base64url with no padding \n  }\n})
  note left #FFE9E9
    4. create proof of origin (PoO)
  end note
  P- -
return { cipherblock, PoO }
note right #FFE9E9
  5. return cipherblock (the consumer cannot
  decrytp it yet), and the PoO
end note

C->C++: validate PoO
C- -
note right #E9FFE9
  6. validate PoO against
  received cipherblock and
  agreed exchange
end note
opt invalid PoO
  C->>P !!: terminate
end
C->C: store PoO
note right #E9FFE9
  7. store PoO
end note
@enduml

PlantUML version 1.2021.16(Wed Dec 08 18:25:22 CET 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>