<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2754px" preserveAspectRatio="none" style="width:1488px;height:2754px;" version="1.1" viewBox="0 0 1488 2754" width="1488px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="Noto Sans" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="296" x="597.5" y="31.2419">Non-repudiable data-exchange log</text><rect fill="#FFFFFF" height="2704.0528" style="stroke: #A80036; stroke-width: 1.0;" width="88" x="196" y="44.5158"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="67" x="206.5" y="58.4129">Consumer</text><rect fill="#FFFFFF" height="2704.0528" style="stroke: #A80036; stroke-width: 1.0;" width="187" x="600.5" y="44.5158"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="55" x="666.5" y="58.4129">Provider</text><rect fill="#90EE90" height="2704.0528" style="stroke: #A80036; stroke-width: 1.0;" width="333" x="1083.5" y="44.5158"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="1182.5" y="58.4129">i3-Market Backplane</text><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="0" x="1251.5" y="76.1189"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="748.5961"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="1034.9321"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2103.8607"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2358.7847"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2468.9027"/><rect fill="#FFFFFF" height="538.1203" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="689" y="170.7697"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="224.6818"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="316.5938"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="642.184"/><rect fill="#FFFFFF" height="614.6323" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="689" y="1101.6381"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="1141.3441"/><rect fill="#FFFFFF" height="70.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1166" y="1576.0343"/><rect fill="#FFFFFF" height="122.5301" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1166" y="1874.5065"/><rect fill="#FFFFFF" height="1876.8367" style="stroke: #000000; stroke-width: 2.0;" width="1471" x="10" y="798.5961"/><rect fill="#FFFFFF" height="1825.4247" style="stroke: none; stroke-width: 1.0;" width="1471" x="10" y="850.0081"/><rect fill="#FFFFFF" height="1477.0887" style="stroke: #000000; stroke-width: 2.0;" width="1451" x="20" y="1191.3441"/><rect fill="#FFFFFF" height="1425.6766" style="stroke: none; stroke-width: 1.0;" width="1451" x="20" y="1242.7562"/><rect fill="#FFFFFF" height="280.7662" style="stroke: #000000; stroke-width: 2.0;" width="1244.5" x="30" y="1731.2704"/><rect fill="#FFFFFF" height="173.9421" style="stroke: #000000; stroke-width: 2.0;" width="1074.5" x="190" y="1831.0945"/><rect fill="#FFFFFF" height="507.5721" style="stroke: #000000; stroke-width: 2.0;" width="1272.5" x="170" y="2153.8607"/><rect fill="#FFFFFF" height="70.118" style="stroke: #000000; stroke-width: 2.0;" width="1232.5" x="190" y="2212.2727"/><rect fill="#FFFFFF" height="372.0421" style="stroke: none; stroke-width: 1.0;" width="1272.5" x="170" y="2289.3908"/><rect fill="#FFFFFF" height="135.5301" style="stroke: #000000; stroke-width: 2.0;" width="1252.5" x="180" y="2518.9027"/><rect fill="#FFFFFF" height="70.118" style="stroke: #000000; stroke-width: 2.0;" width="1232.5" x="190" y="2577.3148"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="240" x2="240" y1="137.0637" y2="2692.4328"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="693.5" x2="693.5" y1="137.0637" y2="2692.4328"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1170.5" x2="1170.5" y1="137.0637" y2="2692.4328"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1338.5" x2="1338.5" y1="137.0637" y2="2692.4328"/><rect fill="#FEFECE" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="200" y="102.9958"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="207" y="124.9617">: SDA SDK</text><rect fill="#FEFECE" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="200" y="2691.4328"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="207" y="2713.3988">: SDA SDK</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="604.5" y="83.9279"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="667.5" y="105.8938">SDA API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="611.5" y="124.9617">: Data Transfer Manager</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="604.5" y="2691.4328"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="667.5" y="2713.3988">SDA API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="611.5" y="2732.4667">: Data Transfer Manager</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="1087.5" y="83.9279"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1123.5" y="105.8938">Backplane API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="1094.5" y="124.9617">: Auditable Accounting</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="1087.5" y="2691.4328"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1123.5" y="2713.3988">Backplane API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="1094.5" y="2732.4667">: Auditable Accounting</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1264.5" y="83.9279"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1291" y="105.8938">Backplane API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="1271.5" y="124.9617">: Conflict Resolution</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1264.5" y="2691.4328"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1291" y="2713.3988">Backplane API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="1271.5" y="2732.4667">: Conflict Resolution</text><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="748.5961"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="1034.9321"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2103.8607"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2358.7847"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2468.9027"/><rect fill="#FFFFFF" height="538.1203" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="689" y="170.7697"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="224.6818"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="316.5938"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="642.184"/><rect fill="#FFFFFF" height="614.6323" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="689" y="1101.6381"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="1141.3441"/><rect fill="#FFFFFF" height="70.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1166" y="1576.0343"/><rect fill="#FFFFFF" height="122.5301" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1166" y="1874.5065"/><polygon fill="#A80036" points="677,166.7697,687,170.7697,677,174.7697,681,170.7697" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="683" y1="170.7697" y2="170.7697"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="247" y="164.9607">GET data {id?: &lt;block_id&gt;}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="704" x2="746" y1="216.6818" y2="216.6818"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="746" x2="746" y1="216.6818" y2="229.6818"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="705" x2="746" y1="229.6818" y2="229.6818"/><polygon fill="#A80036" points="715,225.6818,705,229.6818,715,233.6818,711,229.6818" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="711" y="210.8728">key=new JWK(alg=&lt;algorithm&gt;)</text><path d="M418,183.7697 L418,246.7697 L684,246.7697 L684,193.7697 L674,183.7697 L418,183.7697 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M674,183.7697 L674,193.7697 L684,193.7697 L674,183.7697 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="424" y="202.6667">Create random (high entropy)\none time</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="424" y="220.3728">symmetric JWK secret. The created JWK</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="424" y="238.0788">MUST be uniquely identified by its</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="630" y="238.0788">kid</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="704" x2="746" y1="308.5938" y2="308.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="746" x2="746" y1="308.5938" y2="321.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="705" x2="746" y1="321.5938" y2="321.5938"/><polygon fill="#A80036" points="715,317.5938,705,321.5938,715,325.5938,711,321.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="711" y="299.7848">cipherblock=JWE</text><text fill="#000000" font-family="Noto Sans Mono" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="18" x="831" y="303.6638">key</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="849" y="299.7848">(block)</text><path d="M484,291.8878 L484,318.8878 L684,318.8878 L684,301.8878 L674,291.8878 L484,291.8878 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M674,291.8878 L674,301.8878 L684,301.8878 L674,291.8878 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="490" y="310.7848">encrypt data block with ""key"</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="704" x2="746" y1="634.184" y2="634.184"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="746" x2="746" y1="634.184" y2="647.184"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="705" x2="746" y1="647.184" y2="647.184"/><polygon fill="#A80036" points="715,643.184,705,647.184,715,651.184,711,647.184" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="711" y="377.4908">PoO=JWS</text><text fill="#000000" font-family="Noto Sans Mono" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="48" x="767" y="381.3698">provider</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="815" y="377.4908">({</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="727" y="398.1968">iss: &lt;provider_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="727" y="415.9028">sub: &lt;consumer_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="727" y="433.6089">iat: &lt;timestamp_now&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="727" y="451.3149">exchange: {</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="743" y="469.0209">id: &lt;exchange_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="743" y="486.7269">orig: &lt;provider_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="743" y="504.4329">dest: &lt;consumer_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="743" y="522.1389">block_id: &lt;block_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="743" y="539.845">block_desc: &lt;block_description&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="743" y="557.551">cipherblock: &lt;cipherblock&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="743" y="575.257">block_commitment: &lt;hash_of_block&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="743" y="592.963">key_commitment: &lt;hash_of_key&gt;</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="727" y="610.669">}</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="711" y="628.375">})</text><path d="M432,396.1528 L432,618.1528 L684,618.1528 L684,406.1528 L674,396.1528 L432,396.1528 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M674,396.1528 L674,406.1528 L684,406.1528 L674,396.1528 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="438" y="415.0498">Create proof of origin (PoO).</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="441" y="432.7559"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="438" y="450.4619">block_desc</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="521" y="450.4619">describes the piece of</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="438" y="468.1679">plaintext data (format, size, ...)</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="441" y="485.8739"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="438" y="503.5799">block_commitment</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="569" y="503.5799">is a commitment</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="438" y="521.2859">that can be later used to verify the</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="438" y="538.9919">decrypted cipherblock</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="441" y="556.698"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="438" y="574.404">key_commitment</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="553" y="574.404">is a commitment</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="438" y="592.11">that can be later used to verify the</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="438" y="609.816">received</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="491" y="609.816">key</text><polygon fill="#A80036" points="251,704.8901,241,708.8901,251,712.8901,247,708.8901" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="245" x2="693" y1="708.8901" y2="708.8901"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="257" y="703.0811">PoO</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="287" y1="740.5961" y2="740.5961"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287" x2="287" y1="740.5961" y2="753.5961"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246" x2="287" y1="753.5961" y2="753.5961"/><polygon fill="#A80036" points="256,749.5961,246,753.5961,256,757.5961,252,753.5961" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="252" y="734.7871">validate PoO</text><path d="M10,798.5961 L73,798.5961 L73,807.5961 L63,817.5961 L10,817.5961 L10,798.5961 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1876.8367" style="stroke: #000000; stroke-width: 2.0;" width="1471" x="10" y="798.5961"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="25" y="813.4931">alt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="88" y="812.355">[invalid PoO]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="842.0081" y2="838.0081"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="842.0081" y2="846.0081"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="693" y1="842.0081" y2="842.0081"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="247" y="836.1991">terminate</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="833.0081" y2="851.0081"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="851.0081" y2="833.0081"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="10" x2="1481" y1="851.0081" y2="851.0081"/><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="15" y="862.767">[valid PoO]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="282" y1="890.696" y2="890.696"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="282" x2="282" y1="890.696" y2="903.696"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="241" x2="282" y1="903.696" y2="903.696"/><polygon fill="#A80036" points="251,899.696,241,903.696,251,907.696,247,903.696" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="247" y="884.887">store PoO</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="287" y1="1026.9321" y2="1026.9321"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287" x2="287" y1="1026.9321" y2="1039.9321"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246" x2="287" y1="1039.9321" y2="1039.9321"/><polygon fill="#A80036" points="256,1035.9321,246,1039.9321,256,1043.9321,252,1039.9321" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="252" y="929.593">PoR=JWS</text><text fill="#000000" font-family="Noto Sans Mono" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="48" x="308" y="933.472">consumer</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="356" y="929.593">({</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="268" y="950.299">iss: &lt;consumer_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="268" y="968.0051">sub: &lt;provider_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="268" y="985.7111">iat: &lt;timestamp_now&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="280" x="268" y="1003.4171">poo_dgst: &lt;digest__of_received_PoO&gt;</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="252" y="1021.1231">})</text><path d="M29,965.9611 L29,992.9611 L235,992.9611 L235,975.9611 L225,965.9611 L29,965.9611 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M225,965.9611 L225,975.9611 L235,975.9611 L225,965.9611 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="35" y="984.8581">Create proof of reception (PoR)</text><polygon fill="#A80036" points="677,1097.6381,687,1101.6381,677,1105.6381,681,1101.6381" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="683" y1="1101.6381" y2="1101.6381"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="247" y="1095.8291">PoR</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="704" x2="746" y1="1133.3441" y2="1133.3441"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="746" x2="746" y1="1133.3441" y2="1146.3441"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="705" x2="746" y1="1146.3441" y2="1146.3441"/><polygon fill="#A80036" points="715,1142.3441,705,1146.3441,715,1150.3441,711,1146.3441" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="711" y="1127.5351">validate PoR</text><path d="M20,1191.3441 L83,1191.3441 L83,1200.3441 L73,1210.3441 L20,1210.3441 L20,1191.3441 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1477.0887" style="stroke: #000000; stroke-width: 2.0;" width="1451" x="20" y="1191.3441"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="35" y="1206.2412">alt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="68" x="98" y="1205.1031">[invalid PoR]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="250" y1="1234.7562" y2="1230.7562"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="250" y1="1234.7562" y2="1238.7562"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="688" y1="1234.7562" y2="1234.7562"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="257" y="1228.9472">terminate</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="231" x2="249" y1="1225.7562" y2="1243.7562"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="231" x2="249" y1="1243.7562" y2="1225.7562"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="20" x2="1471" y1="1243.7562" y2="1243.7562"/><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="25" y="1255.5151">[valid PoR]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="699" x2="741" y1="1283.4441" y2="1283.4441"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="741" x2="741" y1="1283.4441" y2="1296.4441"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="700" x2="741" y1="1296.4441" y2="1296.4441"/><polygon fill="#A80036" points="710,1292.4441,700,1296.4441,710,1300.4441,706,1296.4441" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="706" y="1277.6351">store PoR</text><polygon fill="#A80036" points="1154,1572.0343,1164,1576.0343,1154,1580.0343,1158,1576.0343" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="699" x2="1160" y1="1576.0343" y2="1576.0343"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="706" y="1322.3411">POST account</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="706" y="1340.0471">[</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="722" y="1357.7531">{</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="738" y="1375.4591">availability: 'privateStorage',</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="416" x="738" y="1393.1652">permissions: { view: [&lt;providerId&gt;, &lt;consumerId&gt;] },</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="738" y="1410.8712">type: 'dict',</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="738" y="1428.5772">id: &lt;PoO.exchange.exchange_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="408" x="738" y="1446.2832">content: { &lt;block_id&gt;: { PoO: &lt;PoO&gt;, PoR: &lt;PoR&gt; } }</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="722" y="1463.9892">},</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="722" y="1481.6952">{</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="738" y="1499.4013">availability: 'blockchain',</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="738" y="1517.1073">type: 'jwk',</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="738" y="1534.8133">content: { &lt;kid&gt;: &lt;key&gt; }</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="722" y="1552.5193">}</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="706" y="1570.2253">]</text><path d="M1176,1377.2682 L1176,1510.2682 L1456,1510.2682 L1456,1387.2682 L1446,1377.2682 L1176,1377.2682 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1446,1377.2682 L1446,1387.2682 L1456,1387.2682 L1446,1377.2682 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="1182" y="1396.1652">Proofs for this block are added to the</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="1182" y="1413.8712">stored dict of the current exchange.</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1182" y="1431.5772">Proofs can only be viewed by the consumer</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1182" y="1449.2832">and the provider.</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1185" y="1466.9892"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="1182" y="1484.6952">The one-time jwk that was used to encrypt</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="1182" y="1502.4013">the block is published in the blockchain</text><polygon fill="#A80036" points="710,1642.1524,700,1646.1524,710,1650.1524,706,1646.1524" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="704" x2="1170" y1="1646.1524" y2="1646.1524"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="716" y="1640.3434">PoP</text><path d="M418,1589.0343 L418,1687.0343 L684,1687.0343 L684,1599.0343 L674,1589.0343 L418,1589.0343 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M674,1589.0343 L674,1599.0343 L684,1599.0343 L674,1589.0343 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="424" y="1607.9313">The proof of publication (</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="574" y="1607.9313">PoP</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="598" y="1607.9313">) of</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="620" y="1607.9313">key</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="647" y="1607.9313">is a</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="424" y="1625.6374">verification code that includes blockchain</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="424" y="1643.3434">specific information proving that the</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="424" y="1661.0494">requested data has been accounted (e.g.</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="424" y="1678.7554">tx_id</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="3" x="464" y="1678.7554">,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="470" y="1678.7554">block_id</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="534" y="1678.7554">)</text><polygon fill="#A80036" points="251,1712.2704,241,1716.2704,251,1720.2704,247,1716.2704" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="245" x2="693" y1="1716.2704" y2="1716.2704"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="257" y="1710.4614">{ key: &lt;key&gt;, pop: &lt;PoP&gt; }</text><path d="M30,1731.2704 L97,1731.2704 L97,1740.2704 L87,1750.2704 L30,1750.2704 L30,1731.2704 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="280.7662" style="stroke: #000000; stroke-width: 2.0;" width="1244.5" x="30" y="1731.2704"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="45" y="1746.1674">opt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="166" x="112" y="1745.0293">[no response || lost response]</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="246" x2="256" y1="1790.3885" y2="1800.3885"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="246" x2="256" y1="1800.3885" y2="1790.3885"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="252" x2="693" y1="1795.3885" y2="1795.3885"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="257" y="1789.5795">{ key: &lt;key&gt;, pop: &lt;PoP&gt; }</text><path d="M40,1755.9764 L40,1818.9764 L235,1818.9764 L235,1765.9764 L225,1755.9764 L40,1755.9764 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M225,1755.9764 L225,1765.9764 L235,1765.9764 L225,1755.9764 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="46" y="1774.8735">There is a predefined/agreed</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="46" y="1792.5795">max timeout to wait for the</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="46" y="1810.2855">key</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="73" y="1810.2855">to be on the blockchain</text><path d="M190,1831.0945 L263,1831.0945 L263,1840.0945 L253,1850.0945 L190,1850.0945 L190,1831.0945 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="173.9421" style="stroke: #000000; stroke-width: 2.0;" width="1074.5" x="190" y="1831.0945"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="205" y="1845.9915">loop</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="332" x="278" y="1844.8534">[while key not received &amp;&amp; currentTime &lt; PoR.iat + timeout]</text><polygon fill="#A80036" points="1154,1870.5065,1164,1874.5065,1154,1878.5065,1158,1874.5065" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="1160" y1="1874.5065" y2="1874.5065"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="247" y="1868.6975">getKey {kid: &lt;kid&gt;}</text><path d="M865,1887.5065 L865,1967.5065 L1161,1967.5065 L1161,1897.5065 L1151,1887.5065 L865,1887.5065 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1151,1887.5065 L1151,1897.5065 L1161,1897.5065 L1151,1887.5065 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="871" y="1906.4035">Although the Consumer can use i3-market to</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="871" y="1924.1096">connect to the Blockchain and download the</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="871" y="1941.8156">key</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="895" y="1941.8156">, it could also use any other connection to</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="871" y="1959.5216">download it since it is in the public Blockchain</text><polygon fill="#A80036" points="251,1993.0366,241,1997.0366,251,2001.0366,247,1997.0366" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="245" x2="1170" y1="1997.0366" y2="1997.0366"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="257" y="1991.2276">{ key: &lt;key&gt;, pop: &lt;PoP&gt; }</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="287" y1="2095.8607" y2="2095.8607"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287" x2="287" y1="2095.8607" y2="2108.8607"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246" x2="287" y1="2108.8607" y2="2108.8607"/><polygon fill="#A80036" points="256,2104.8607,246,2108.8607,256,2112.8607,252,2108.8607" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="252" y="2036.9336">verify that:</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="268" y="2054.6396">key has been received</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="268" y="2072.3457">PoP is valid</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="268" y="2090.0517">hash(key) == PoO.key_commitment</text><path d="M170,2153.8607 L233,2153.8607 L233,2162.8607 L223,2172.8607 L170,2172.8607 L170,2153.8607 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="507.5721" style="stroke: #000000; stroke-width: 2.0;" width="1272.5" x="170" y="2153.8607"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="185" y="2168.7577">alt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="248" y="2167.6196">[validation failed]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="2197.2727" y2="2193.2727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="2197.2727" y2="2201.2727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="693" y1="2197.2727" y2="2197.2727"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="247" y="2191.4637">terminate</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="2188.2727" y2="2206.2727"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="2206.2727" y2="2188.2727"/><path d="M190,2212.2727 L257,2212.2727 L257,2221.2727 L247,2231.2727 L190,2231.2727 L190,2212.2727 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="70.118" style="stroke: #000000; stroke-width: 2.0;" width="1232.5" x="190" y="2212.2727"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="205" y="2227.1697">opt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="272" y="2226.0316">[conflict resolution]</text><rect fill="#FFFFFF" height="45.412" style="stroke: #000000; stroke-width: 2.0;" width="1218.5" x="197" y="2231.9787"/><polygon fill="#EEEEEE" points="197,2231.9787,261,2231.9787,261,2240.9787,251,2250.9787,197,2250.9787,197,2231.9787" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="210" y="2247.8757">ref</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="752.75" y="2268.8757">conflict resolution</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="170" x2="1442.5" y1="2290.3908" y2="2290.3908"/><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="175" y="2302.1497">[validation succeed]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="287" y1="2350.7847" y2="2350.7847"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287" x2="287" y1="2350.7847" y2="2363.7847"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246" x2="287" y1="2363.7847" y2="2363.7847"/><polygon fill="#A80036" points="256,2359.7847,246,2363.7847,256,2367.7847,252,2363.7847" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="252" y="2324.2697">decrypt cipherblock with key:</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="268" y="2341.9757">decryptedBlock=Dec</text><text fill="#000000" font-family="Noto Sans Mono" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="18" x="412" y="2345.8547">key</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="430" y="2341.9757">(PoO.exchange.cipherblock)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="287" y1="2460.9027" y2="2460.9027"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287" x2="287" y1="2460.9027" y2="2473.9027"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246" x2="287" y1="2473.9027" y2="2473.9027"/><polygon fill="#A80036" points="256,2469.9027,246,2473.9027,256,2477.9027,252,2473.9027" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="252" y="2419.6817">validate that:</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424" x="268" y="2437.3877">hash(decryptedBlock) == PoO.exchange.block_commitment</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="352" x="268" y="2455.0937">decryptedBlock meets PoO.exchange.block_desc</text><path d="M180,2518.9027 L247,2518.9027 L247,2527.9027 L237,2537.9027 L180,2537.9027 L180,2518.9027 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.5301" style="stroke: #000000; stroke-width: 2.0;" width="1252.5" x="180" y="2518.9027"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="195" y="2533.7997">opt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="262" y="2532.6616">[validation failed]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="2562.3148" y2="2558.3148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="2562.3148" y2="2566.3148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="693" y1="2562.3148" y2="2562.3148"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="247" y="2556.5058">terminate</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="2553.3148" y2="2571.3148"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="2571.3148" y2="2553.3148"/><path d="M190,2577.3148 L257,2577.3148 L257,2586.3148 L247,2596.3148 L190,2596.3148 L190,2577.3148 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="70.118" style="stroke: #000000; stroke-width: 2.0;" width="1232.5" x="190" y="2577.3148"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="205" y="2592.2118">opt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="272" y="2591.0737">[conflict resolution]</text><rect fill="#FFFFFF" height="45.412" style="stroke: #000000; stroke-width: 2.0;" width="1218.5" x="197" y="2597.0208"/><polygon fill="#EEEEEE" points="197,2597.0208,261,2597.0208,261,2606.0208,251,2616.0208,197,2616.0208,197,2597.0208" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="210" y="2612.9178">ref</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="752.75" y="2633.9178">conflict resolution</text><!--MD5=[df4cb23483b2f0c9c1b3ff9c1adbc360]
@startuml nonRepudiableExchangeLog
skinparam shadowing false
skinparam DefaultFontName Noto Sans
skinparam DefaultMonospacedFontName Noto Sans Mono
skinparam ArrowFontName Noto Sans Mono
skinparam maxMessageSize 450

title Non-repudiable data-exchange log

box "Consumer" #White
    participant ": SDA SDK" as C
end box
box "Provider" #White
    participant "SDA API\n: Data Transfer Manager" as P
end box
box "i3-Market Backplane\n" #LightGreen
    participant "Backplane API\n: Auditable Accounting" as AA
    participant "Backplane API\n: Conflict Resolution" as CR
end box

C->P++: GET data {id?: <block_id>}
    P->P++: key=new JWK(alg=<algorithm>)
    P- -
    note left
        Create random (high entropy)\none time
        symmetric JWK secret. The created JWK 
        MUST be uniquely identified by its ""kid""
    end note
    P->P++: cipherblock=JWE<sub>key</sub>(block)
    P- -
    note left
      encrypt data block with ""key"
    end note
    P->P++: PoO=JWS<sub>provider</sub>({\n  iss: <provider_id>,\n  sub: <consumer_id>,\n  iat: <timestamp_now>,\n  exchange: {\n    id: <exchange_id>,\n    orig: <provider_id>,\n    dest: <consumer_id>,\n    block_id: <block_id>,\n    block_desc: <block_description>,\n    cipherblock: <cipherblock>,\n    block_commitment: <hash_of_block>,\n    key_commitment: <hash_of_key>\n  }\n})
    note left
        Create proof of origin (PoO).

        ""block_desc"" describes the piece of
        plaintext data (format, size, ...)

        ""block_commitment"" is a commitment
        that can be later used to verify the
        decrypted cipherblock

        ""key_commitment"" is a commitment 
        that can be later used to verify the 
        received ""key""
    end note
    P- -
return PoO

C->C++: validate PoO
C- -

alt invalid PoO
    C->>P !!: terminate
else valid PoO
    C->C: store PoO
    C->C++: PoR=JWS<sub>consumer</sub>({\n  iss: <consumer_id>,\n  sub: <provider_id>,\n  iat: <timestamp_now>,\n  poo_dgst: <digest__of_received_PoO>\n})
    C- -
    note left
      Create proof of reception (PoR)
    end note
    C->P++: PoR
    P->P++: validate PoR
    P- -
    alt invalid PoR
        P->>C !!: terminate
    else valid PoR
        P->P: store PoR
        P->AA++: POST account \n[\n  {\n    availability: 'privateStorage',\n    permissions: { view: [<providerId>, <consumerId>] },\n    type: 'dict',\n    id: <PoO.exchange.exchange_id>,\n    content: { <block_id>: { PoO: <PoO>, PoR: <PoR> } }\n  },\n  {\n    availability: 'blockchain',\n    type: 'jwk',\n    content: { <kid>: <key> }\n  }\n]
        note right
          Proofs for this block are added to the
          stored dict of the current exchange.
          Proofs can only be viewed by the consumer
          and the provider.

          The one-time jwk that was used to encrypt 
          the block is published in the blockchain 
        end note
        return PoP
        note left
          The proof of publication (""PoP"") of ""key"" is a
          verification code that includes blockchain
          specific information proving that the 
          requested data has been accounted (e.g. 
          ""tx_id"", ""block_id"")
        end note
        return { key: <key>, pop: <PoP> }
        opt no response || lost response
            P ->x C: { key: <key>, pop: <PoP> }
            note left
              There is a predefined/agreed 
              max timeout to wait for the 
              ""key"" to be on the blockchain
            end note
            loop while key not received && currentTime < PoR.iat + timeout
                C->AA++: getKey {kid: <kid>}
                note left of AA
                    Although the Consumer can use i3-market to
                    connect to the Blockchain and download the 
                    ""key"", it could also use any other connection to 
                    download it since it is in the public Blockchain
                end note
                return { key: <key>, pop: <PoP> }
            end
        end
        
        C->C++: verify that:\n  key has been received\n  PoP is valid\n  hash(key) == PoO.key_commitment
        C- -

        alt validation failed
            C->>P !!: terminate
            opt conflict resolution
                ref over C, P, AA, CR
                    conflict resolution
                end ref
            end
        else validation succeed
            C->C++: decrypt cipherblock with key:\n  decryptedBlock=Dec<sub>key</sub>(PoO.exchange.cipherblock)
            C- -
            C->C++: validate that:\n  hash(decryptedBlock) == PoO.exchange.block_commitment\n  decryptedBlock meets PoO.exchange.block_desc
            C- -
            opt validation failed
                C->>P !!: terminate
                opt conflict resolution
                    ref over C, P, AA, CR
                        conflict resolution
                    end ref
                end
            end
        end
    end
end
@enduml

PlantUML version 1.2020.19(Mon Oct 12 17:10:01 CEST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>