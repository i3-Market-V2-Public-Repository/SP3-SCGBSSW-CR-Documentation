<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="2789px" preserveAspectRatio="none" style="width:1488px;height:2789px;" version="1.1" viewBox="0 0 1488 2789" width="1488px" zoomAndPan="magnify"><defs/><g><text fill="#000000" font-family="Noto Sans" font-size="18" lengthAdjust="spacingAndGlyphs" textLength="296" x="597.5" y="31.2419">Non-repudiable data-exchange log</text><rect fill="#FFFFFF" height="2739.4648" style="stroke: #A80036; stroke-width: 1.0;" width="88" x="196" y="44.5158"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="67" x="206.5" y="58.4129">Consumer</text><rect fill="#FFFFFF" height="2739.4648" style="stroke: #A80036; stroke-width: 1.0;" width="187" x="600.5" y="44.5158"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="55" x="666.5" y="58.4129">Provider</text><rect fill="#90EE90" height="2739.4648" style="stroke: #A80036; stroke-width: 1.0;" width="333" x="1083.5" y="44.5158"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="135" x="1182.5" y="58.4129">i3-Market Backplane</text><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="0" x="1251.5" y="76.1189"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="766.3021"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="1070.3441"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2139.2727"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2394.1967"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2504.3148"/><rect fill="#FFFFFF" height="555.8263" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="689" y="170.7697"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="224.6818"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="316.5938"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="659.8901"/><rect fill="#FFFFFF" height="614.6323" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="689" y="1137.0502"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="1176.7562"/><rect fill="#FFFFFF" height="70.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1166" y="1611.4464"/><rect fill="#FFFFFF" height="122.5301" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1166" y="1909.9186"/><rect fill="#FFFFFF" height="1894.5428" style="stroke: #000000; stroke-width: 2.0;" width="1471" x="10" y="816.3021"/><rect fill="#FFFFFF" height="1843.1307" style="stroke: none; stroke-width: 1.0;" width="1471" x="10" y="867.7141"/><rect fill="#FFFFFF" height="1477.0887" style="stroke: #000000; stroke-width: 2.0;" width="1451" x="20" y="1226.7562"/><rect fill="#FFFFFF" height="1425.6766" style="stroke: none; stroke-width: 1.0;" width="1451" x="20" y="1278.1682"/><rect fill="#FFFFFF" height="280.7662" style="stroke: #000000; stroke-width: 2.0;" width="1244.5" x="30" y="1766.6825"/><rect fill="#FFFFFF" height="173.9421" style="stroke: #000000; stroke-width: 2.0;" width="1074.5" x="190" y="1866.5065"/><rect fill="#FFFFFF" height="507.5721" style="stroke: #000000; stroke-width: 2.0;" width="1272.5" x="170" y="2189.2727"/><rect fill="#FFFFFF" height="70.118" style="stroke: #000000; stroke-width: 2.0;" width="1232.5" x="190" y="2247.6847"/><rect fill="#FFFFFF" height="372.0421" style="stroke: none; stroke-width: 1.0;" width="1272.5" x="170" y="2324.8028"/><rect fill="#FFFFFF" height="135.5301" style="stroke: #000000; stroke-width: 2.0;" width="1252.5" x="180" y="2554.3148"/><rect fill="#FFFFFF" height="70.118" style="stroke: #000000; stroke-width: 2.0;" width="1232.5" x="190" y="2612.7268"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="240" x2="240" y1="137.0637" y2="2727.8448"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="693.5" x2="693.5" y1="137.0637" y2="2727.8448"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1170.5" x2="1170.5" y1="137.0637" y2="2727.8448"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 5.0,5.0;" x1="1338.5" x2="1338.5" y1="137.0637" y2="2727.8448"/><rect fill="#FEFECE" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="200" y="102.9958"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="207" y="124.9617">: SDA SDK</text><rect fill="#FEFECE" height="33.0679" style="stroke: #A80036; stroke-width: 1.5;" width="80" x="200" y="2726.8448"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="66" x="207" y="2748.8108">: SDA SDK</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="604.5" y="83.9279"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="667.5" y="105.8938">SDA API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="611.5" y="124.9617">: Data Transfer Manager</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="179" x="604.5" y="2726.8448"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="53" x="667.5" y="2748.8108">SDA API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="165" x="611.5" y="2767.8787">: Data Transfer Manager</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="1087.5" y="83.9279"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1123.5" y="105.8938">Backplane API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="1094.5" y="124.9617">: Auditable Accounting</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="167" x="1087.5" y="2726.8448"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1123.5" y="2748.8108">Backplane API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="153" x="1094.5" y="2767.8787">: Auditable Accounting</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1264.5" y="83.9279"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1291" y="105.8938">Backplane API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="1271.5" y="124.9617">: Conflict Resolution</text><rect fill="#FEFECE" height="52.1358" style="stroke: #A80036; stroke-width: 1.5;" width="148" x="1264.5" y="2726.8448"/><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="95" x="1291" y="2748.8108">Backplane API</text><text fill="#000000" font-family="Noto Sans" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="134" x="1271.5" y="2767.8787">: Conflict Resolution</text><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="766.3021"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="1070.3441"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2139.2727"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2394.1967"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="235" y="2504.3148"/><rect fill="#FFFFFF" height="555.8263" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="689" y="170.7697"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="224.6818"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="316.5938"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="659.8901"/><rect fill="#FFFFFF" height="614.6323" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="689" y="1137.0502"/><rect fill="#FFFFFF" height="28" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="694" y="1176.7562"/><rect fill="#FFFFFF" height="70.118" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1166" y="1611.4464"/><rect fill="#FFFFFF" height="122.5301" style="stroke: #A80036; stroke-width: 1.0;" width="10" x="1166" y="1909.9186"/><polygon fill="#A80036" points="677,166.7697,687,170.7697,677,174.7697,681,170.7697" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="683" y1="170.7697" y2="170.7697"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="247" y="164.9607">GET data {id?: &lt;block_id&gt;}</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="704" x2="746" y1="216.6818" y2="216.6818"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="746" x2="746" y1="216.6818" y2="229.6818"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="705" x2="746" y1="229.6818" y2="229.6818"/><polygon fill="#A80036" points="715,225.6818,705,229.6818,715,233.6818,711,229.6818" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="224" x="711" y="210.8728">key=new JWK(alg=&lt;algorithm&gt;)</text><path d="M418,183.7697 L418,246.7697 L684,246.7697 L684,193.7697 L674,183.7697 L418,183.7697 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M674,183.7697 L674,193.7697 L684,193.7697 L674,183.7697 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="424" y="202.6667">Create random (high entropy)\none time</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="424" y="220.3728">symmetric JWK secret. The created JWK</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="203" x="424" y="238.0788">MUST be uniquely identified by its</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="630" y="238.0788">kid</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="704" x2="746" y1="308.5938" y2="308.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="746" x2="746" y1="308.5938" y2="321.5938"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="705" x2="746" y1="321.5938" y2="321.5938"/><polygon fill="#A80036" points="715,317.5938,705,321.5938,715,325.5938,711,321.5938" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="120" x="711" y="299.7848">cipherblock=Enc</text><text fill="#000000" font-family="Noto Sans Mono" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="18" x="831" y="303.6638">key</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="849" y="299.7848">(block)</text><path d="M484,291.8878 L484,318.8878 L684,318.8878 L684,301.8878 L674,291.8878 L484,291.8878 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M674,291.8878 L674,301.8878 L684,301.8878 L674,291.8878 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="179" x="490" y="310.7848">encrypt data block with ""key"</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="704" x2="746" y1="651.8901" y2="651.8901"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="746" x2="746" y1="651.8901" y2="664.8901"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="705" x2="746" y1="664.8901" y2="664.8901"/><polygon fill="#A80036" points="715,660.8901,705,664.8901,715,668.8901,711,664.8901" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="711" y="377.4908">PoO=JWS</text><text fill="#000000" font-family="Noto Sans Mono" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="48" x="767" y="381.3698">provider</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="815" y="377.4908">({</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="727" y="398.1968">iss: &lt;provider_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="727" y="415.9028">sub: &lt;consumer_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="727" y="433.6089">iat: &lt;timestamp_now&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="88" x="727" y="451.3149">exchange: {</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="743" y="469.0209">id: &lt;exchange_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="743" y="486.7269">orig: &lt;provider_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="743" y="504.4329">dest: &lt;consumer_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="743" y="522.1389">block_id: &lt;block_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="743" y="539.845">block_desc: &lt;block_description&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="743" y="557.551">hash_alg: &lt;hash_algorithm&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="743" y="575.257">cipherblock_dgst: &lt;hash_of_cipherblock&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="272" x="743" y="592.963">block_commitment: &lt;hash_of_block&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="743" y="610.669">key_commitment: &lt;hash_of_key&gt;</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="727" y="628.375">}</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="711" y="646.0811">})</text><path d="M432,405.0058 L432,627.0058 L684,627.0058 L684,415.0058 L674,405.0058 L432,405.0058 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M674,405.0058 L674,415.0058 L684,415.0058 L674,405.0058 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="438" y="423.9028">Create proof of origin (PoO).</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="441" y="441.6089"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="80" x="438" y="459.3149">block_desc</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="521" y="459.3149">describes the piece of</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="178" x="438" y="477.0209">plaintext data (format, size, ...)</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="441" y="494.7269"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="128" x="438" y="512.4329">block_commitment</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="569" y="512.4329">is a commitment</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="438" y="530.1389">that can be later used to verify the</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="133" x="438" y="547.845">decrypted cipherblock</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="441" y="565.551"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="438" y="583.257">key_commitment</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="100" x="553" y="583.257">is a commitment</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="204" x="438" y="600.963">that can be later used to verify the</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="50" x="438" y="618.669">received</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="491" y="618.669">key</text><polygon fill="#A80036" points="251,722.5961,241,726.5961,251,730.5961,247,726.5961" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="245" x2="693" y1="726.5961" y2="726.5961"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="257" y="720.7871">{ cipherblock, PoO }</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="287" y1="758.3021" y2="758.3021"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287" x2="287" y1="758.3021" y2="771.3021"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246" x2="287" y1="771.3021" y2="771.3021"/><polygon fill="#A80036" points="256,767.3021,246,771.3021,256,775.3021,252,771.3021" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="252" y="752.4931">validate PoO</text><path d="M10,816.3021 L73,816.3021 L73,825.3021 L63,835.3021 L10,835.3021 L10,816.3021 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1894.5428" style="stroke: #000000; stroke-width: 2.0;" width="1471" x="10" y="816.3021"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="25" y="831.1991">alt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="70" x="88" y="830.061">[invalid PoO]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="859.7141" y2="855.7141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="859.7141" y2="863.7141"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="693" y1="859.7141" y2="859.7141"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="247" y="853.9051">terminate</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="850.7141" y2="868.7141"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="868.7141" y2="850.7141"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="10" x2="1481" y1="868.7141" y2="868.7141"/><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="60" x="15" y="880.473">[valid PoO]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="282" y1="908.402" y2="908.402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="282" x2="282" y1="908.402" y2="921.402"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="241" x2="282" y1="921.402" y2="921.402"/><polygon fill="#A80036" points="251,917.402,241,921.402,251,925.402,247,921.402" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="247" y="902.593">store PoO</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="287" y1="1062.3441" y2="1062.3441"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287" x2="287" y1="1062.3441" y2="1075.3441"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246" x2="287" y1="1075.3441" y2="1075.3441"/><polygon fill="#A80036" points="256,1071.3441,246,1075.3441,256,1079.3441,252,1075.3441" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="56" x="252" y="947.299">PoR=JWS</text><text fill="#000000" font-family="Noto Sans Mono" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="48" x="308" y="951.1781">consumer</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="356" y="947.299">({</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="268" y="968.0051">iss: &lt;consumer_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="268" y="985.7111">sub: &lt;provider_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="268" y="1003.4171">iat: &lt;timestamp_now&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="268" y="1021.1231">hash_alg: &lt;hash_algorithm&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="256" x="268" y="1038.8291">poo_dgst: &lt;hash_of_received_PoO&gt;</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="252" y="1056.5351">})</text><path d="M29,992.5201 L29,1019.5201 L235,1019.5201 L235,1002.5201 L225,992.5201 L29,992.5201 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M225,992.5201 L225,1002.5201 L235,1002.5201 L225,992.5201 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="185" x="35" y="1011.4171">Create proof of reception (PoR)</text><polygon fill="#A80036" points="677,1133.0502,687,1137.0502,677,1141.0502,681,1137.0502" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="683" y1="1137.0502" y2="1137.0502"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="247" y="1131.2412">PoR</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="704" x2="746" y1="1168.7562" y2="1168.7562"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="746" x2="746" y1="1168.7562" y2="1181.7562"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="705" x2="746" y1="1181.7562" y2="1181.7562"/><polygon fill="#A80036" points="715,1177.7562,705,1181.7562,715,1185.7562,711,1181.7562" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="711" y="1162.9472">validate PoR</text><path d="M20,1226.7562 L83,1226.7562 L83,1235.7562 L73,1245.7562 L20,1245.7562 L20,1226.7562 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="1477.0887" style="stroke: #000000; stroke-width: 2.0;" width="1451" x="20" y="1226.7562"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="35" y="1241.6532">alt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="68" x="98" y="1240.5151">[invalid PoR]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="250" y1="1270.1682" y2="1266.1682"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="250" y1="1270.1682" y2="1274.1682"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="688" y1="1270.1682" y2="1270.1682"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="257" y="1264.3592">terminate</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="231" x2="249" y1="1261.1682" y2="1279.1682"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="231" x2="249" y1="1279.1682" y2="1261.1682"/><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="20" x2="1471" y1="1279.1682" y2="1279.1682"/><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="58" x="25" y="1290.9271">[valid PoR]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="699" x2="741" y1="1318.8561" y2="1318.8561"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="741" x2="741" y1="1318.8561" y2="1331.8561"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="700" x2="741" y1="1331.8561" y2="1331.8561"/><polygon fill="#A80036" points="710,1327.8561,700,1331.8561,710,1335.8561,706,1331.8561" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="706" y="1313.0471">store PoR</text><polygon fill="#A80036" points="1154,1607.4464,1164,1611.4464,1154,1615.4464,1158,1611.4464" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="699" x2="1160" y1="1611.4464" y2="1611.4464"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="706" y="1357.7531">POST account</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="706" y="1375.4591">[</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="722" y="1393.1652">{</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="738" y="1410.8712">availability: 'privateStorage',</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="416" x="738" y="1428.5772">permissions: { view: [&lt;providerId&gt;, &lt;consumerId&gt;] },</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="738" y="1446.2832">type: 'dict',</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="738" y="1463.9892">id: &lt;PoO.exchange.exchange_id&gt;,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="408" x="738" y="1481.6952">content: { &lt;block_id&gt;: { PoO: &lt;PoO&gt;, PoR: &lt;PoR&gt; } }</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="16" x="722" y="1499.4013">},</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="722" y="1517.1073">{</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="216" x="738" y="1534.8133">availability: 'blockchain',</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="738" y="1552.5193">type: 'jwk',</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="200" x="738" y="1570.2253">content: { &lt;kid&gt;: &lt;key&gt; }</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="722" y="1587.9313">}</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="8" x="706" y="1605.6374">]</text><path d="M1176,1412.6802 L1176,1545.6802 L1456,1545.6802 L1456,1422.6802 L1446,1412.6802 L1176,1412.6802 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1446,1412.6802 L1446,1422.6802 L1456,1422.6802 L1446,1412.6802 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="221" x="1182" y="1431.5772">Proofs for this block are added to the</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="213" x="1182" y="1449.2832">stored dict of the current exchange.</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="259" x="1182" y="1466.9892">Proofs can only be viewed by the consumer</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="103" x="1182" y="1484.6952">and the provider.</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="0" x="1185" y="1502.4013"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="253" x="1182" y="1520.1073">The one-time jwk that was used to encrypt</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="233" x="1182" y="1537.8133">the block is published in the blockchain</text><polygon fill="#A80036" points="710,1677.5644,700,1681.5644,710,1685.5644,706,1681.5644" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="704" x2="1170" y1="1681.5644" y2="1681.5644"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="716" y="1675.7554">PoP</text><path d="M418,1624.4464 L418,1722.4464 L684,1722.4464 L684,1634.4464 L674,1624.4464 L418,1624.4464 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M674,1624.4464 L674,1634.4464 L684,1634.4464 L674,1624.4464 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="150" x="424" y="1643.3434">The proof of publication (</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="574" y="1643.3434">PoP</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="598" y="1643.3434">) of</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="620" y="1643.3434">key</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="19" x="647" y="1643.3434">is a</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="245" x="424" y="1661.0494">verification code that includes blockchain</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="218" x="424" y="1678.7554">specific information proving that the</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="242" x="424" y="1696.4614">requested data has been accounted (e.g.</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="40" x="424" y="1714.1674">tx_id</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="3" x="464" y="1714.1674">,</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="64" x="470" y="1714.1674">block_id</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="4" x="534" y="1714.1674">)</text><polygon fill="#A80036" points="251,1747.6825,241,1751.6825,251,1755.6825,247,1751.6825" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="245" x2="693" y1="1751.6825" y2="1751.6825"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="257" y="1745.8735">{ key: &lt;key&gt;, pop: &lt;PoP&gt; }</text><path d="M30,1766.6825 L97,1766.6825 L97,1775.6825 L87,1785.6825 L30,1785.6825 L30,1766.6825 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="280.7662" style="stroke: #000000; stroke-width: 2.0;" width="1244.5" x="30" y="1766.6825"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="45" y="1781.5795">opt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="166" x="112" y="1780.4414">[no response || lost response]</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="246" x2="256" y1="1825.8005" y2="1835.8005"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="246" x2="256" y1="1835.8005" y2="1825.8005"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="252" x2="693" y1="1830.8005" y2="1830.8005"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="257" y="1824.9915">{ key: &lt;key&gt;, pop: &lt;PoP&gt; }</text><path d="M40,1791.3885 L40,1854.3885 L235,1854.3885 L235,1801.3885 L225,1791.3885 L40,1791.3885 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M225,1791.3885 L225,1801.3885 L235,1801.3885 L225,1791.3885 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="171" x="46" y="1810.2855">There is a predefined/agreed</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="164" x="46" y="1827.9915">max timeout to wait for the</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="46" y="1845.6975">key</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="73" y="1845.6975">to be on the blockchain</text><path d="M190,1866.5065 L263,1866.5065 L263,1875.5065 L253,1885.5065 L190,1885.5065 L190,1866.5065 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="173.9421" style="stroke: #000000; stroke-width: 2.0;" width="1074.5" x="190" y="1866.5065"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="28" x="205" y="1881.4035">loop</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="332" x="278" y="1880.2654">[while key not received &amp;&amp; currentTime &lt; PoR.iat + timeout]</text><polygon fill="#A80036" points="1154,1905.9186,1164,1909.9186,1154,1913.9186,1158,1909.9186" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="1160" y1="1909.9186" y2="1909.9186"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="152" x="247" y="1904.1096">getKey {kid: &lt;kid&gt;}</text><path d="M865,1922.9186 L865,2002.9186 L1161,2002.9186 L1161,1932.9186 L1151,1922.9186 L865,1922.9186 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><path d="M1151,1922.9186 L1151,1932.9186 L1161,1932.9186 L1151,1922.9186 " fill="#FBFB77" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="268" x="871" y="1941.8156">Although the Consumer can use i3-market to</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="266" x="871" y="1959.5216">connect to the Blockchain and download the</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="24" x="871" y="1977.2276">key</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="895" y="1977.2276">, it could also use any other connection to</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="270" x="871" y="1994.9336">download it since it is in the public Blockchain</text><polygon fill="#A80036" points="251,2028.4486,241,2032.4486,251,2036.4486,247,2032.4486" style="stroke: #A80036; stroke-width: 1.0;"/><line style="stroke: #A80036; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="245" x2="1170" y1="2032.4486" y2="2032.4486"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="208" x="257" y="2026.6396">{ key: &lt;key&gt;, pop: &lt;PoP&gt; }</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="287" y1="2131.2727" y2="2131.2727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287" x2="287" y1="2131.2727" y2="2144.2727"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246" x2="287" y1="2144.2727" y2="2144.2727"/><polygon fill="#A80036" points="256,2140.2727,246,2144.2727,256,2148.2727,252,2144.2727" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="252" y="2072.3457">verify that:</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="168" x="268" y="2090.0517">key has been received</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="96" x="268" y="2107.7577">PoP is valid</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="248" x="268" y="2125.4637">hash(key) == PoO.key_commitment</text><path d="M170,2189.2727 L233,2189.2727 L233,2198.2727 L223,2208.2727 L170,2208.2727 L170,2189.2727 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="507.5721" style="stroke: #000000; stroke-width: 2.0;" width="1272.5" x="170" y="2189.2727"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="18" x="185" y="2204.1697">alt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="248" y="2203.0316">[validation failed]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="2232.6847" y2="2228.6847"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="2232.6847" y2="2236.6847"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="693" y1="2232.6847" y2="2232.6847"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="247" y="2226.8757">terminate</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="2223.6847" y2="2241.6847"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="2241.6847" y2="2223.6847"/><path d="M190,2247.6847 L257,2247.6847 L257,2256.6847 L247,2266.6847 L190,2266.6847 L190,2247.6847 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="70.118" style="stroke: #000000; stroke-width: 2.0;" width="1232.5" x="190" y="2247.6847"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="205" y="2262.5818">opt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="272" y="2261.4437">[conflict resolution]</text><rect fill="#FFFFFF" height="45.412" style="stroke: #000000; stroke-width: 2.0;" width="1218.5" x="197" y="2267.3908"/><polygon fill="#EEEEEE" points="197,2267.3908,261,2267.3908,261,2276.3908,251,2286.3908,197,2286.3908,197,2267.3908" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="210" y="2283.2878">ref</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="752.75" y="2304.2878">conflict resolution</text><line style="stroke: #000000; stroke-width: 1.0; stroke-dasharray: 2.0,2.0;" x1="170" x2="1442.5" y1="2325.8028" y2="2325.8028"/><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="111" x="175" y="2337.5617">[validation succeed]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="287" y1="2386.1967" y2="2386.1967"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287" x2="287" y1="2386.1967" y2="2399.1967"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246" x2="287" y1="2399.1967" y2="2399.1967"/><polygon fill="#A80036" points="256,2395.1967,246,2399.1967,256,2403.1967,252,2399.1967" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="232" x="252" y="2359.6817">decrypt cipherblock with key:</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="144" x="268" y="2377.3877">decryptedBlock=Dec</text><text fill="#000000" font-family="Noto Sans Mono" font-size="10" lengthAdjust="spacingAndGlyphs" textLength="18" x="412" y="2381.2667">key</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="430" y="2377.3877">(cipherblock)</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="245" x2="287" y1="2496.3148" y2="2496.3148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="287" x2="287" y1="2496.3148" y2="2509.3148"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="246" x2="287" y1="2509.3148" y2="2509.3148"/><polygon fill="#A80036" points="256,2505.3148,246,2509.3148,256,2513.3148,252,2509.3148" style="stroke: #A80036; stroke-width: 1.0;"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="252" y="2455.0937">validate that:</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="424" x="268" y="2472.7997">hash(decryptedBlock) == PoO.exchange.block_commitment</text><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="352" x="268" y="2490.5058">decryptedBlock meets PoO.exchange.block_desc</text><path d="M180,2554.3148 L247,2554.3148 L247,2563.3148 L237,2573.3148 L180,2573.3148 L180,2554.3148 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="135.5301" style="stroke: #000000; stroke-width: 2.0;" width="1252.5" x="180" y="2554.3148"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="195" y="2569.2118">opt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="97" x="262" y="2568.0737">[validation failed]</text><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="2597.7268" y2="2593.7268"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="692" x2="682" y1="2597.7268" y2="2601.7268"/><line style="stroke: #A80036; stroke-width: 1.0;" x1="240" x2="693" y1="2597.7268" y2="2597.7268"/><text fill="#000000" font-family="Noto Sans Mono" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="72" x="247" y="2591.9178">terminate</text><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="2588.7268" y2="2606.7268"/><line style="stroke: #A80036; stroke-width: 2.0;" x1="685" x2="703" y1="2606.7268" y2="2588.7268"/><path d="M190,2612.7268 L257,2612.7268 L257,2621.7268 L247,2631.7268 L190,2631.7268 L190,2612.7268 " fill="#EEEEEE" style="stroke: #000000; stroke-width: 1.0;"/><rect fill="none" height="70.118" style="stroke: #000000; stroke-width: 2.0;" width="1232.5" x="190" y="2612.7268"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="22" x="205" y="2627.6238">opt</text><text fill="#000000" font-family="Noto Sans" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="108" x="272" y="2626.4857">[conflict resolution]</text><rect fill="#FFFFFF" height="45.412" style="stroke: #000000; stroke-width: 2.0;" width="1218.5" x="197" y="2632.4328"/><polygon fill="#EEEEEE" points="197,2632.4328,261,2632.4328,261,2641.4328,251,2651.4328,197,2651.4328,197,2632.4328" style="stroke: #000000; stroke-width: 2.0;"/><text fill="#000000" font-family="Noto Sans" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="19" x="210" y="2648.3298">ref</text><text fill="#000000" font-family="Noto Sans" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="107" x="752.75" y="2669.3298">conflict resolution</text><!--MD5=[7cd2894099a1e0000c2a1574705aaefb]
@startuml nonRepudiableExchangeLog
skinparam shadowing false
skinparam DefaultFontName Noto Sans
skinparam DefaultMonospacedFontName Noto Sans Mono
skinparam ArrowFontName Noto Sans Mono
skinparam maxMessageSize 450

title Non-repudiable data-exchange log

box "Consumer" #White
    participant ": SDA SDK" as C
end box
box "Provider" #White
    participant "SDA API\n: Data Transfer Manager" as P
end box
box "i3-Market Backplane\n" #LightGreen
    participant "Backplane API\n: Auditable Accounting" as AA
    participant "Backplane API\n: Conflict Resolution" as CR
end box

C->P++: GET data {id?: <block_id>}
    P->P++: key=new JWK(alg=<algorithm>)
    P- -
    note left
        Create random (high entropy)\none time
        symmetric JWK secret. The created JWK 
        MUST be uniquely identified by its ""kid""
    end note
    P->P++: cipherblock=Enc<sub>key</sub>(block)
    P- -
    note left
      encrypt data block with ""key"
    end note
    P->P++: PoO=JWS<sub>provider</sub>({\n  iss: <provider_id>,\n  sub: <consumer_id>,\n  iat: <timestamp_now>,\n  exchange: {\n    id: <exchange_id>,\n    orig: <provider_id>,\n    dest: <consumer_id>,\n    block_id: <block_id>,\n    block_desc: <block_description>,\n    hash_alg: <hash_algorithm>,\n    cipherblock_dgst: <hash_of_cipherblock>,\n    block_commitment: <hash_of_block>,\n    key_commitment: <hash_of_key>\n  }\n})
    note left
        Create proof of origin (PoO).

        ""block_desc"" describes the piece of
        plaintext data (format, size, ...)

        ""block_commitment"" is a commitment
        that can be later used to verify the
        decrypted cipherblock

        ""key_commitment"" is a commitment 
        that can be later used to verify the 
        received ""key""
    end note
    P- -
return { cipherblock, PoO }

C->C++: validate PoO
C- -

alt invalid PoO
    C->>P !!: terminate
else valid PoO
    C->C: store PoO
    C->C++: PoR=JWS<sub>consumer</sub>({\n  iss: <consumer_id>,\n  sub: <provider_id>,\n  iat: <timestamp_now>,\n  hash_alg: <hash_algorithm>,\n  poo_dgst: <hash_of_received_PoO>\n})
    C- -
    note left
      Create proof of reception (PoR)
    end note
    C->P++: PoR
    P->P++: validate PoR
    P- -
    alt invalid PoR
        P->>C !!: terminate
    else valid PoR
        P->P: store PoR
        P->AA++: POST account \n[\n  {\n    availability: 'privateStorage',\n    permissions: { view: [<providerId>, <consumerId>] },\n    type: 'dict',\n    id: <PoO.exchange.exchange_id>,\n    content: { <block_id>: { PoO: <PoO>, PoR: <PoR> } }\n  },\n  {\n    availability: 'blockchain',\n    type: 'jwk',\n    content: { <kid>: <key> }\n  }\n]
        note right
          Proofs for this block are added to the
          stored dict of the current exchange.
          Proofs can only be viewed by the consumer
          and the provider.

          The one-time jwk that was used to encrypt 
          the block is published in the blockchain 
        end note
        return PoP
        note left
          The proof of publication (""PoP"") of ""key"" is a
          verification code that includes blockchain
          specific information proving that the 
          requested data has been accounted (e.g. 
          ""tx_id"", ""block_id"")
        end note
        return { key: <key>, pop: <PoP> }
        opt no response || lost response
            P ->x C: { key: <key>, pop: <PoP> }
            note left
              There is a predefined/agreed 
              max timeout to wait for the 
              ""key"" to be on the blockchain
            end note
            loop while key not received && currentTime < PoR.iat + timeout
                C->AA++: getKey {kid: <kid>}
                note left of AA
                    Although the Consumer can use i3-market to
                    connect to the Blockchain and download the 
                    ""key"", it could also use any other connection to 
                    download it since it is in the public Blockchain
                end note
                return { key: <key>, pop: <PoP> }
            end
        end
        
        C->C++: verify that:\n  key has been received\n  PoP is valid\n  hash(key) == PoO.key_commitment
        C- -

        alt validation failed
            C->>P !!: terminate
            opt conflict resolution
                ref over C, P, AA, CR
                    conflict resolution
                end ref
            end
        else validation succeed
            C->C++: decrypt cipherblock with key:\n  decryptedBlock=Dec<sub>key</sub>(cipherblock)
            C- -
            C->C++: validate that:\n  hash(decryptedBlock) == PoO.exchange.block_commitment\n  decryptedBlock meets PoO.exchange.block_desc
            C- -
            opt validation failed
                C->>P !!: terminate
                opt conflict resolution
                    ref over C, P, AA, CR
                        conflict resolution
                    end ref
                end
            end
        end
    end
end
@enduml

PlantUML version 1.2020.19(Mon Oct 12 17:10:01 CEST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>